<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>All Posts - æŠ“é±¼ zzy's Blog</title><link>https://nil-zhuang.github.io/posts/</link><description>All Posts | æŠ“é±¼ zzy's Blog</description><generator>Hugo -- gohugo.io</generator><language>zh-CN</language><managingEditor>ziyuan.zhuang@smail.nju.edu.cn (Nil Zhuang)</managingEditor><webMaster>ziyuan.zhuang@smail.nju.edu.cn (Nil Zhuang)</webMaster><copyright>Ziyuan Zhuang 2022</copyright><lastBuildDate>Fri, 27 Jan 2023 14:59:43 +0800</lastBuildDate><atom:link href="https://nil-zhuang.github.io/posts/" rel="self" type="application/rss+xml"/><item><title>Macè½¯ä»¶å®‰è£…çš„æ–—æ™ºæ–—å‹‡</title><link>https://nil-zhuang.github.io/2023/01/mac_software_install/</link><pubDate>Fri, 27 Jan 2023 14:59:43 +0800</pubDate><author>nil zhuang</author><guid>https://nil-zhuang.github.io/2023/01/mac_software_install/</guid><description><![CDATA[<div class="featured-image">
                <img src="https://lemonzzy.oss-cn-hangzhou.aliyuncs.com/typora/202301271540904.png" referrerpolicy="no-referrer">
            </div><h1 id="mac-å®‰è£…è½¯ä»¶çš„æ–—æ™ºæ–—å‹‡">Mac å®‰è£…è½¯ä»¶çš„æ–—æ™ºæ–—å‹‡</h1>
<p>mac æœ€æ ‡å‡†çš„è½¯ä»¶å®‰è£…æ¸ é“æ˜¯ App Storeï¼Œç„¶è€Œä¸Šé¢è¦ä¹ˆè½¯ä»¶ä¸å…¨ï¼Œè¦ä¹ˆå¯¹åº”è½¯ä»¶åŠŸèƒ½æ¯”å®˜ç½‘ä¸‹è½½ç‰ˆæœ¬æœ‰ç¼ºå¤±ï¼ˆå¦‚ parallel desktopï¼‰ï¼Œå› æ­¤å¤§å¤šæ•°è½¯ä»¶çš„å®‰è£…æˆ‘ä¼šé€‰æ‹© <code>brew</code> æˆ–å®˜ç½‘ä¸‹è½½ï¼Œè¿™ç§æ–¹æ³•æœ¬è´¨æ˜¯ dmg å®‰è£…ã€‚
æ„Ÿè°¢ <a href="https://b23.tv/GFmJgTa" target="_blank" rel="noopener noreffer ">åœ¨ Mac ä¸Šè£…è½¯ä»¶ï¼Œè¦å­¦ä¼šå’Œè‹¹æœæ–—æ™ºæ–—å‹‡</a> æä¾›çš„æŒ‡å¯¼ï¼Œæ¨èå¤§å®¶ä» <a href="https://macapp.org.cn/" target="_blank" rel="noopener noreffer ">MacAppåˆ†äº«é¢‘é“</a> æä¸€äº›ç ´è§£è½¯ä»¶ã€‚</p>
<p>é€šå¸¸é‡åˆ°çš„ä¸€äº›é—®é¢˜æ¥è‡ª <a href="https://en.wikipedia.org/wiki/Gatekeeper_%28macOS%29" target="_blank" rel="noopener noreffer ">Gatekeeper (macOS) - Wikipedia</a>ï¼Œå¯¹åº”è§£å†³æ–¹æ³•å¦‚ä¸‹ã€‚</p>
<p>æ— æ³•æ‰“å¼€ XXXï¼Œå› ä¸ºæ— æ³•éªŒè¯å¼€å‘è€… â†’ å› ä¸ºå¼€å‘è€…æ²¡æœ‰ç»™è½¯ä»¶åšå…¬è¯</p>
<ol>
<li>ç³»ç»Ÿ â†’ éšç§ä¸å®‰å…¨æ€§ â†’ ä»è¦æ‰“å¼€ XXX è½¯ä»¶</li>
<li><code>/Application/XXX</code> å³é”®ä»è¦æ‰“å¼€</li>
<li>å¼€å¯ç³»ç»Ÿ â†’ éšç§ä¸å®‰å…¨æ€§ â†’ ä»»ä½•æ¥æº <code>sudo spctl --master-disable</code>ï¼Œå¦‚æœä»»ä½•æ¥æºæƒé™åˆ‡æ¢å›å»ï¼Œåˆä¼šè¢«å…³æ‰</li>
</ol>
<p>è½¯ä»¶å·²æŸåï¼Œå› ä¸ºå¯¹åº”çš„éš”ç¦»å±æ€§å’Œæœ¬æœºä¿¡æ¯å¯¹ä¸ä¸Š</p>
<ol>
<li>åˆ é™¤è½¯ä»¶éš”ç¦»å±æ€§ <code>sudo xattr -r -d com.apple.quarantine /Application/XXX</code></li>
</ol>
]]></description></item><item><title>âš¡ï¸+ğŸ¤—ï¼šTransformers + Pytorch Lightning æœ€ä½³å®æˆ˜</title><link>https://nil-zhuang.github.io/2022/11/hf_pl/</link><pubDate>Mon, 14 Nov 2022 11:50:04 +0800</pubDate><author>nil zhuang</author><guid>https://nil-zhuang.github.io/2022/11/hf_pl/</guid><description><![CDATA[<div class="featured-image">
                <img src="https://lemonzzy.oss-cn-hangzhou.aliyuncs.com/typora/202211141605838.png" referrerpolicy="no-referrer">
            </div><h1 id="transformers--pytorch-lightning-æœ€ä½³å®æˆ˜">âš¡ï¸+ğŸ¤—ï¼šTransformers + Pytorch Lightning æœ€ä½³å®æˆ˜</h1>
<h2 id="èƒŒæ™¯">èƒŒæ™¯</h2>
<p>Pytorch Lightning æ˜¯ pytorch çš„ä¸€ä¸ªä¸Šå±‚å°è£…ï¼Œç±»ä¼¼äº Keras ä¹‹äº tensorflowã€‚æˆ‘ä»¬å¸Œæœ›ä½¿ç”¨è¿™æ ·ä¸€ä¸ªä¼˜ç§€çš„æ¡†æ¶æ¥å®ç°å¯¹ huggingface æ¨¡å‹çš„å¿«é€Ÿè®­ç»ƒå’Œå¼€å‘æµ‹è¯•ã€‚</p>
<h2 id="æ•°æ®é›†-dataset">æ•°æ®é›† Dataset</h2>
<p>å¯¹äºä»»ä½•ä¸€ä¸ª datasetï¼Œå°†å…¶æ‹†åˆ†ä¸ºæœ‰ç›‘ç£è®­ç»ƒçš„ src å’Œ tgt ä¸¤ä¸ª label</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DataModule</span><span class="p">(</span><span class="n">Dataset</span><span class="p">):</span>  
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>  
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">        <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">        <span class="n">tokenizer</span><span class="p">:</span> <span class="n">PreTrainedTokenizer</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">        <span class="n">source_max_token_len</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">        <span class="n">target_max_token_len</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34; Pytorch Dataset Module for input data  
</span></span></span><span class="line"><span class="cl"><span class="s2">        Args:            data (pd.DataFrame): Dataframe containing input data            tokenizer (PreTrainedTokenizer): Tokenizer for encoding input data            source_max_token_len (int): Max token length for source text            target_max_token_len (int): Max token length for target text        &#34;&#34;&#34;</span>        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>  
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">tokenizer</span>  
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">source_max_token_len</span> <span class="o">=</span> <span class="n">source_max_token_len</span>  
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">target_max_token_len</span> <span class="o">=</span> <span class="n">target_max_token_len</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>  
</span></span><span class="line"><span class="cl">        <span class="n">data_row</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">        <span class="n">src_text_encoding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span><span class="p">(</span>  
</span></span><span class="line"><span class="cl">            <span class="n">data_row</span><span class="p">[</span><span class="s2">&#34;src&#34;</span><span class="p">],</span>  
</span></span><span class="line"><span class="cl">            <span class="n">max_length</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">source_max_token_len</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">padding</span><span class="o">=</span><span class="s2">&#34;max_length&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">truncation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&#34;pt&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">return_attention_mask</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">add_special_tokens</span><span class="o">=</span><span class="kc">True</span>  
</span></span><span class="line"><span class="cl">        <span class="p">)</span>  
</span></span><span class="line"><span class="cl">        <span class="n">tgt_text_encoding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span><span class="p">(</span>  
</span></span><span class="line"><span class="cl">            <span class="n">data_row</span><span class="p">[</span><span class="s1">&#39;tgt&#39;</span><span class="p">],</span>  
</span></span><span class="line"><span class="cl">            <span class="n">max_length</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">target_max_token_len</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">padding</span><span class="o">=</span><span class="s2">&#34;max_length&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">truncation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">return_attention_mask</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&#34;pt&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">add_special_tokens</span><span class="o">=</span><span class="kc">True</span>  
</span></span><span class="line"><span class="cl">        <span class="p">)</span>  
</span></span><span class="line"><span class="cl">        <span class="n">labels</span> <span class="o">=</span> <span class="n">tgt_text_encoding</span><span class="p">[</span><span class="s2">&#34;input_ids&#34;</span><span class="p">]</span>  
</span></span><span class="line"><span class="cl">        <span class="n">labels</span><span class="p">[</span><span class="n">labels</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">100</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span>  
</span></span><span class="line"><span class="cl">            <span class="n">source_text_input_ids</span><span class="o">=</span><span class="n">src_text_encoding</span><span class="p">[</span><span class="s2">&#34;input_ids&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>  
</span></span><span class="line"><span class="cl">            <span class="n">source_text_attention_mask</span><span class="o">=</span><span class="n">src_text_encoding</span><span class="p">[</span><span class="s2">&#34;attention_mask&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>  
</span></span><span class="line"><span class="cl">            <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>  
</span></span><span class="line"><span class="cl">            <span class="n">labels_attention_mask</span><span class="o">=</span><span class="n">tgt_text_encoding</span><span class="p">[</span><span class="s2">&#34;attention_mask&#34;</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>  
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åæ„å»º dataset moduleï¼Œç»„åˆ training data å’Œ valid data</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">DatasetModule</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">LightningDataModule</span><span class="p">):</span>  
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>  
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">        <span class="n">train_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">        <span class="n">valid_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">        <span class="n">tokenizer</span><span class="p">:</span> <span class="n">PreTrainedTokenizer</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">        <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">        <span class="n">source_max_token_len</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">512</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">        <span class="n">target_max_token_len</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">512</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">        <span class="n">num_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">        <span class="n">shuffle</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  
</span></span><span class="line"><span class="cl">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>  
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">tokenizer</span>  
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">train_df</span> <span class="o">=</span> <span class="n">train_df</span>  
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">valid_df</span> <span class="o">=</span> <span class="n">valid_df</span>  
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">batch_size</span>  
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">source_max_token_len</span> <span class="o">=</span> <span class="n">source_max_token_len</span>  
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">target_max_token_len</span> <span class="o">=</span> <span class="n">target_max_token_len</span>  
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">num_workers</span> <span class="o">=</span> <span class="n">num_workers</span>  
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">shuffle</span> <span class="o">=</span> <span class="n">shuffle</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">setup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">stage</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>  
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">train_dataset</span> <span class="o">=</span> <span class="n">DataModule</span><span class="p">(</span>  
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">train_df</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">source_max_token_len</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">target_max_token_len</span>  
</span></span><span class="line"><span class="cl">        <span class="p">)</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">valid_dataset</span> <span class="o">=</span> <span class="n">DataModule</span><span class="p">(</span>  
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">valid_df</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">source_max_token_len</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">target_max_token_len</span>  
</span></span><span class="line"><span class="cl">        <span class="p">)</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">train_dataloader</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">DataLoader</span><span class="p">(</span>  
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">train_dataset</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">batch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">shuffle</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">shuffle</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">num_workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_workers</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">pin_memory</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">        <span class="p">)</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">val_dataloader</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">DataLoader</span><span class="p">(</span>  
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">valid_dataset</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">batch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">num_workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_workers</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">pin_memory</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">        <span class="p">)</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">test_dataloader</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">DataLoader</span><span class="p">(</span>  
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">valid_dataset</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">batch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">num_workers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_workers</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">pin_memory</span><span class="o">=</span><span class="kc">True</span>  
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="æ¨¡å‹">æ¨¡å‹</h2>
<p>æˆ‘ä»¬ä»¥ T5 ä¸ºä¾‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">T5Seq2SeqLM</span><span class="p">(</span><span class="n">T5ForConditionalGeneration</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>  
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">:</span> <span class="n">T5Config</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>  
</span></span><span class="line"><span class="cl">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">hidden_state_sample</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hidden_states</span><span class="p">,</span> <span class="n">attention_mask</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AutoEncoderOutput</span><span class="p">:</span>  
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34; Sample from the hidden state distribution  
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;&#34;&#34;</span>        <span class="k">return</span> <span class="n">AutoEncoderOutput</span><span class="p">(</span>  
</span></span><span class="line"><span class="cl">            <span class="n">hidden_states</span><span class="o">=</span><span class="n">hidden_states</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">attention_mask</span><span class="o">=</span><span class="n">attention_mask</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">        <span class="p">)</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">compute_loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lm_logits</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">ae_output</span><span class="p">:</span> <span class="n">AutoEncoderOutput</span><span class="p">):</span>  
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34; Compute the loss  
</span></span></span><span class="line"><span class="cl"><span class="s2">        Args:            lm_logits (torch.FloatTensor): logits from the language model            labels (torch.LongTensor): labels for the language model            ae_output (AutoEncoderOutput): output from the autoencoder        Returns:            torch.FloatTensor: loss        &#34;&#34;&#34;</span>        <span class="n">loss</span> <span class="o">=</span> <span class="kc">None</span>  
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  
</span></span><span class="line"><span class="cl">            <span class="n">loss_fct</span> <span class="o">=</span> <span class="n">CrossEntropyLoss</span><span class="p">(</span><span class="n">ignore_index</span><span class="o">=-</span><span class="mi">100</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">            <span class="n">loss</span> <span class="o">=</span> <span class="n">loss_fct</span><span class="p">(</span><span class="n">lm_logits</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">lm_logits</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)),</span> <span class="n">labels</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>  
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">loss</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">prepare_inputs_for_generation</span><span class="p">(</span>  
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">input_ids</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">past</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">attention_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">head_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">decoder_head_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="c1"># cross_attn_head_mask=None,  </span>
</span></span><span class="line"><span class="cl">            <span class="n">use_cache</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">encoder_outputs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="o">**</span><span class="n">kwargs</span>  
</span></span><span class="line"><span class="cl">    <span class="p">):</span>  
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">past</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>  
</span></span><span class="line"><span class="cl">            <span class="n">input_ids</span> <span class="o">=</span> <span class="n">input_ids</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">:]</span>  
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;decoder_input_ids&#34;</span><span class="p">:</span> <span class="n">input_ids</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;past_key_values&#34;</span><span class="p">:</span> <span class="n">past</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;encoder_outputs&#34;</span><span class="p">:</span> <span class="n">encoder_outputs</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;attention_mask&#34;</span><span class="p">:</span> <span class="n">attention_mask</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;head_mask&#34;</span><span class="p">:</span> <span class="n">head_mask</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;decoder_head_mask&#34;</span><span class="p">:</span> <span class="n">decoder_head_mask</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="c1"># &#34;cross_attn_head_mask&#34;: cross_attn_head_mask,  </span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;use_cache&#34;</span><span class="p">:</span> <span class="n">use_cache</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="è®­ç»ƒ">è®­ç»ƒ</h2>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦æ„å»ºä¸€ä¸ª HFModel çš„åŸºç¡€æ¡†æ¶ï¼Œç»™ pytorch lightning è°ƒç”¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">HFModel</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">LightningModule</span><span class="p">):</span>  
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>  
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">tokenizer</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">model</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  
</span></span><span class="line"><span class="cl">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>  
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>  
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">tokenizer</span>  
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">average_training_loss</span> <span class="o">=</span> <span class="kc">None</span>  
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">average_validation_loss</span> <span class="o">=</span> <span class="kc">None</span>  
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">config</span> <span class="o">=</span> <span class="n">config</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_ids</span><span class="p">,</span> <span class="n">attention_mask</span><span class="p">,</span> <span class="n">decoder_attention_mask</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>  
</span></span><span class="line"><span class="cl">        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">(</span>  
</span></span><span class="line"><span class="cl">            <span class="n">input_ids</span><span class="o">=</span><span class="n">input_ids</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">attention_mask</span><span class="o">=</span><span class="n">attention_mask</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">decoder_attention_mask</span><span class="o">=</span><span class="n">decoder_attention_mask</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">        <span class="p">)</span>  
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">output</span><span class="o">.</span><span class="n">loss</span><span class="p">,</span> <span class="n">output</span><span class="o">.</span><span class="n">logits</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">compute_loss</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>  
</span></span><span class="line"><span class="cl">        <span class="n">input_ids</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s1">&#39;source_text_input_ids&#39;</span><span class="p">]</span>  
</span></span><span class="line"><span class="cl">        <span class="n">attention_mask</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s1">&#39;source_text_attention_mask&#39;</span><span class="p">]</span>  
</span></span><span class="line"><span class="cl">        <span class="n">labels_attention_mask</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s1">&#39;labels_attention_mask&#39;</span><span class="p">]</span>  
</span></span><span class="line"><span class="cl">        <span class="n">labels</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">        <span class="n">loss</span><span class="p">,</span> <span class="n">logits</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span>  
</span></span><span class="line"><span class="cl">            <span class="n">input_ids</span><span class="o">=</span><span class="n">input_ids</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">attention_mask</span><span class="o">=</span><span class="n">attention_mask</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">decoder_attention_mask</span><span class="o">=</span><span class="n">labels_attention_mask</span>  
</span></span><span class="line"><span class="cl">        <span class="p">)</span>  
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">loss</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">training_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>  
</span></span><span class="line"><span class="cl">        <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_loss</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&#34;train_loss&#34;</span><span class="p">,</span> <span class="n">loss</span><span class="p">,</span> <span class="n">prog_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_epoch</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_step</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sync_dist</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">loss</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">validation_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>  
</span></span><span class="line"><span class="cl">        <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_loss</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&#34;val_loss&#34;</span><span class="p">,</span> <span class="n">loss</span><span class="p">,</span> <span class="n">prog_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_epoch</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_step</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sync_dist</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">loss</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">test_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>  
</span></span><span class="line"><span class="cl">        <span class="n">loss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_loss</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s2">&#34;test_loss&#34;</span><span class="p">,</span> <span class="n">loss</span><span class="p">,</span> <span class="n">prog_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">sync_dist</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">loss</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">configure_optimizers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  
</span></span><span class="line"><span class="cl">        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">AdamW</span><span class="p">(</span>  
</span></span><span class="line"><span class="cl">            <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span>  
</span></span><span class="line"><span class="cl">            <span class="n">lr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">][</span><span class="s1">&#39;learning_rate&#39;</span><span class="p">]</span>  
</span></span><span class="line"><span class="cl">        <span class="p">)</span>        <span class="n">scheduler</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">lr_scheduler</span><span class="o">.</span><span class="n">ReduceLROnPlateau</span><span class="p">(</span>  
</span></span><span class="line"><span class="cl">            <span class="n">optimizer</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">patience</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span>  
</span></span><span class="line"><span class="cl">        <span class="p">)</span>  
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;optimizer&#34;</span><span class="p">:</span> <span class="n">optimizer</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;lr_scheduler&#34;</span><span class="p">:</span> <span class="p">{</span>  
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;scheduler&#34;</span><span class="p">:</span> <span class="n">scheduler</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;monitor&#34;</span><span class="p">:</span> <span class="s2">&#34;val_loss&#34;</span>  
</span></span><span class="line"><span class="cl">            <span class="p">}</span>  
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>transformers æœ€å¤§çš„ä¸åŒåœ¨äºå®ƒçš„ checkpointï¼Œéœ€è¦ save_pretrained å’Œ from_pretrainedï¼Œå› æ­¤æˆ‘ä»¬è¦è®¾è®¡ä¸€ä¸ªå•ç‹¬çš„ checkpoint æ–¹æ³•ï¼Œå³ HFTrainer</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">HFTrainer</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">Trainer</span><span class="p">):</span>  
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">save_checkpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">],</span> <span class="n">weights_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">storage_options</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>  
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_global_zero</span><span class="p">:</span>  
</span></span><span class="line"><span class="cl">            <span class="n">dpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">filepath</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34;=&#34;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">            <span class="n">lightning_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">module</span><span class="o">.</span><span class="n">module</span>  
</span></span><span class="line"><span class="cl">            <span class="n">lightning_model</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">save_pretrained</span><span class="p">(</span><span class="n">dpath</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">            <span class="n">lightning_model</span><span class="o">.</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">save_pretrained</span><span class="p">(</span><span class="n">dpath</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æœ€åè¿›è¡Œæ•°æ®é›†æ„é€ å’Œè®­ç»ƒæ–¹æ³•</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">train</span><span class="p">(</span>  
</span></span><span class="line"><span class="cl">        <span class="n">model</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">        <span class="n">tokenizer</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">        <span class="n">train_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">        <span class="n">eval_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">        <span class="n">config</span><span class="p">:</span> <span class="n">Dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl"><span class="p">):</span>  
</span></span><span class="line"><span class="cl">    <span class="n">hf_model</span> <span class="o">=</span> <span class="n">HFModel</span><span class="p">(</span>  
</span></span><span class="line"><span class="cl">        <span class="n">tokenizer</span><span class="o">=</span><span class="n">tokenizer</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">        <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">        <span class="n">config</span><span class="o">=</span><span class="n">config</span>  
</span></span><span class="line"><span class="cl">    <span class="p">)</span>  
</span></span><span class="line"><span class="cl">    <span class="n">dataset</span> <span class="o">=</span> <span class="n">DatasetModule</span><span class="p">(</span>  
</span></span><span class="line"><span class="cl">        <span class="n">train_df</span><span class="o">=</span><span class="n">train_df</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">        <span class="n">valid_df</span><span class="o">=</span><span class="n">eval_df</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">        <span class="n">tokenizer</span><span class="o">=</span><span class="n">tokenizer</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">        <span class="n">batch_size</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">][</span><span class="s1">&#39;batch_size&#39;</span><span class="p">],</span>  
</span></span><span class="line"><span class="cl">        <span class="n">source_max_token_len</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">][</span><span class="s1">&#39;source_max_token_len&#39;</span><span class="p">],</span>  
</span></span><span class="line"><span class="cl">        <span class="n">target_max_token_len</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;dataset&#39;</span><span class="p">][</span><span class="s1">&#39;target_max_token_len&#39;</span><span class="p">],</span>  
</span></span><span class="line"><span class="cl">        <span class="n">num_workers</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">][</span><span class="s1">&#39;dataloader_num_workers&#39;</span><span class="p">],</span>  
</span></span><span class="line"><span class="cl">    <span class="p">)</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="n">callbacks</span> <span class="o">=</span> <span class="p">[</span>  
</span></span><span class="line"><span class="cl">        <span class="n">RichProgressBar</span><span class="p">(</span><span class="n">refresh_rate</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>  
</span></span><span class="line"><span class="cl">        <span class="n">EarlyStopping</span><span class="p">(</span>  
</span></span><span class="line"><span class="cl">            <span class="n">monitor</span><span class="o">=</span><span class="s2">&#34;val_loss&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">patience</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">][</span><span class="s1">&#39;early_stop_patience&#39;</span><span class="p">],</span>  
</span></span><span class="line"><span class="cl">            <span class="n">min_delta</span><span class="o">=</span><span class="mf">0.00</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">            <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">        <span class="p">)]</span>  
</span></span><span class="line"><span class="cl">    <span class="n">checkpoint_callback</span> <span class="o">=</span> <span class="n">ModelCheckpoint</span><span class="p">(</span>  
</span></span><span class="line"><span class="cl">        <span class="n">dirpath</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>  
</span></span><span class="line"><span class="cl">            <span class="n">config</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">][</span><span class="s1">&#39;save_dir&#39;</span><span class="p">],</span>  
</span></span><span class="line"><span class="cl">            <span class="n">config</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>  
</span></span><span class="line"><span class="cl">        <span class="p">),</span>  
</span></span><span class="line"><span class="cl">        <span class="n">filename</span><span class="o">=</span><span class="s2">&#34;</span><span class="si">{epoch}</span><span class="s2">-</span><span class="si">{step}</span><span class="s2">-</span><span class="si">{val_loss:.2f}</span><span class="s2">-</span><span class="si">{train_loss:.2f}</span><span class="s2">&#34;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">        <span class="n">monitor</span><span class="o">=</span><span class="s1">&#39;val_loss&#39;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">    <span class="p">)</span>  
</span></span><span class="line"><span class="cl">    <span class="n">callbacks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">checkpoint_callback</span><span class="p">)</span>  
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="n">trainer</span> <span class="o">=</span> <span class="n">HFTrainer</span><span class="p">(</span>  
</span></span><span class="line"><span class="cl">        <span class="n">logger</span><span class="o">=</span><span class="n">pl_logger</span><span class="o">.</span><span class="n">TensorBoardLogger</span><span class="p">(</span><span class="n">save_dir</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">][</span><span class="s1">&#39;log_dir&#39;</span><span class="p">]),</span>  
</span></span><span class="line"><span class="cl">        <span class="n">callbacks</span><span class="o">=</span><span class="n">callbacks</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">        <span class="n">max_epochs</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">][</span><span class="s1">&#39;max_epoch&#39;</span><span class="p">],</span>  
</span></span><span class="line"><span class="cl">        <span class="n">accelerator</span><span class="o">=</span><span class="s1">&#39;gpu&#39;</span> <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">is_available</span><span class="p">()</span> <span class="k">else</span> <span class="s1">&#39;cpu&#39;</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">        <span class="n">devices</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">        <span class="n">precision</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">        <span class="n">auto_select_gpus</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">        <span class="n">log_every_n_steps</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">        <span class="n">strategy</span><span class="o">=</span><span class="n">DDPStrategy</span><span class="p">(</span><span class="n">find_unused_parameters</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>  
</span></span><span class="line"><span class="cl">        <span class="n">accumulate_grad_batches</span><span class="o">=</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;train&#39;</span><span class="p">][</span><span class="s1">&#39;accumulate_grad_batches&#39;</span><span class="p">],</span>  
</span></span><span class="line"><span class="cl">        <span class="n">auto_lr_find</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">    <span class="p">)</span>  
</span></span><span class="line"><span class="cl">    <span class="n">trainer</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">hf_model</span><span class="p">,</span> <span class="n">dataset</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description></item><item><title>Hugoä¸ªäººåšå®¢æ­å»º</title><link>https://nil-zhuang.github.io/2022/10/hugo/</link><pubDate>Fri, 28 Oct 2022 16:16:54 +0800</pubDate><author>nil zhuang</author><guid>https://nil-zhuang.github.io/2022/10/hugo/</guid><description><![CDATA[<div class="featured-image">
                <img src="https://lemonzzy.oss-cn-hangzhou.aliyuncs.com/typora/202210281638413.png" referrerpolicy="no-referrer">
            </div><h1 id="hugo-ä¸ªäººåšå®¢æ­å»º">Hugo ä¸ªäººåšå®¢æ­å»º</h1>
<p>ä½¿ç”¨ <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer ">The worldâ€™s fastest framework for building websites | Hugo</a> ç»“åˆ <a href="https://hugoloveit.com/" target="_blank" rel="noopener noreffer ">LoveIt</a> ä¸»é¢˜ï¼Œéƒ¨ç½²è‡ªå·±çš„ GitPage åšå®¢ <a href="https://nil-zhuang.github.io/" target="_blank" rel="noopener noreffer ">æŠ“é±¼</a></p>
<p>æ–¹æ¡ˆæ ¸å¿ƒéƒ¨åˆ†ï¼š</p>
<ol>
<li>åœ¨ Github æ‰˜ç®¡ä¸ªäººåšå®¢æºä»“åº“ï¼Œå¯¹æ‰€æœ‰çš„åšå®¢æ–‡ç« è¿›è¡Œç‰ˆæœ¬ç®¡ç†ï¼Œå¹¶ä½¿ç”¨ GitHub Action è¿›è¡Œ CI/CD éƒ¨ç½²ï¼Œè‡ªåŠ¨å‘ GitHub Pages ä»“åº“è¿›è¡Œé™æ€é¡µé¢çš„å‘å¸ƒ</li>
<li>GitHub Pages é€šè¿‡ <code>github.io</code> ç½‘å€è¿›è¡Œåšå®¢ç½‘é¡µæ‰˜ç®¡å’Œå‘å¸ƒ</li>
<li>Hugo ä¸»é¢˜ä»“åº“ï¼Œä½¿ç”¨ <code>git submodule</code> æ–¹æ³•é“¾æ¥åˆ°åšå®¢æºä»“åº“</li>
</ol>
<h2 id="å‰è¨€">å‰è¨€</h2>
<blockquote>
<p>Hugo is one of the most popular open-source static site generators. With its amazing speed and flexibility, Hugo makes building websites fun again.</p>
</blockquote>
<p>Hugo æ˜¯åŸºäº Go çš„åšå®¢å·¥å…·ï¼Œç”¨ markdown è¿›è¡Œæ–‡ç« ç¼–è¾‘ã€‚</p>
<p>ç›¸è¾ƒäºä½¿ç”¨ node çš„ Hexo è€Œè¨€ï¼Œå…·æœ‰ç¼–è¯‘æ›´å¿«ã€æ¨¡å—æ›´è½»é‡ï¼ˆä¼—æ‰€å‘¨çŸ¥ï¼Œnode_modules æ˜¯åœ°çƒä¸Šæœ€é‡çš„ä¸œè¥¿ï¼‰ã€å‘å¸ƒæ›´ç®€å•çš„ä¼˜ç‚¹ã€‚è€Œä¸”æ›´ä¸éœ€è¦ä½¿ç”¨æ„šè ¢çš„ node å’Œ npm è¿›è¡Œç®¡ç†ï¼Œå®åœ¨æ˜¯ä»¤äººå¿ƒåŠ¨ã€‚</p>
<h2 id="å®‰è£…--é…ç½®">å®‰è£… &amp; é…ç½®</h2>
<p>æœ¬æ–‡åŸºäº macos ç³»ç»Ÿæè¿°ï¼Œå…¶ä»–æ“ä½œç³»ç»Ÿè¯·å‚è€ƒé¡¹ç›®æºæ–‡æ¡£ã€‚</p>
<h3 id="åŸºæœ¬å®‰è£…æ–¹æ³•">åŸºæœ¬å®‰è£…æ–¹æ³•</h3>
<p>å¯¹ hugo ç¨‹åºçš„å®‰è£…ï¼Œä½¿ç”¨ mac æœ€æ ‡å‡†çš„ <code>homebrew</code> è¿›è¡Œç¨‹åºå®‰è£…å’Œç®¡ç†ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">brew install hugo
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åå¯ä»¥ä½¿ç”¨ <code>hugo version</code> éªŒè¯å®‰è£…æˆåŠŸã€‚</p>
<p>å®Œæˆå®‰è£…åï¼Œå¯ä»¥ç”¨ä¸‹åˆ—å‘½ä»¤è¿›è¡Œç½‘é¡µçš„åˆ›å»º</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">hugo new site blog
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ä¸»é¢˜é…ç½®">ä¸»é¢˜é…ç½®</h3>
<p>é€‰æ‹© <a href="https://hugoloveit.com/" target="_blank" rel="noopener noreffer ">LoveIt</a> ä¸»é¢˜è¿›è¡Œä¸»é¢˜é…ç½®ï¼Œå‚è€ƒ <a href="https://hugoloveit.com/theme-documentation-basics/" target="_blank" rel="noopener noreffer ">Theme Documentation - Basics - LoveIt</a>j è¿›è¡Œç»†èŠ‚é…ç½®</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">cd</span> blog
</span></span><span class="line"><span class="cl">git init
</span></span><span class="line"><span class="cl">git submodule add https://github.com/dillonzq/LoveIt.git themes/LoveIt
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>[!note]
åŠ¨æ€èµ„æºæ”¾åœ¨ asserts ä¸‹æ–¹ï¼Œä¾‹å¦‚å¤´åƒ <code>avatar.jpeg</code>
é™æ€èµ„æºæ”¾åœ¨ static ä¸‹æ–¹ï¼Œä¾‹å¦‚ params.app.svgFaviconï¼Œ</p>
</blockquote>
<h4 id="æ›´æ–°ä¸»é¢˜">æ›´æ–°ä¸»é¢˜</h4>
<p>å¦‚æœéœ€è¦å¯¹ä¸»é¢˜ä»“åº“è¿›è¡ŒåŒæ­¥å’Œæ›´æ–°ï¼Œå¯ä»¥ä½¿ç”¨ <code>git submodule update --remote</code></p>
<h4 id="æ–‡ç« å‘å¸ƒ">æ–‡ç« å‘å¸ƒ</h4>
<p>hugo åˆ›å»ºæ–‡ç« ä½¿ç”¨ <code>hugo new posts/POST_NAME.md</code> è¿›è¡Œå‘å¸ƒï¼Œä½¿ç”¨ <code>archetype/default.md</code> çš„é»˜è®¤é…ç½®ï¼Œå‚è€ƒ <a href="https://hugoloveit.com/theme-documentation-content/" target="_blank" rel="noopener noreffer ">Theme Documentation - Content - LoveIt</a></p>
<h4 id="æœ¬åœ°è°ƒè¯•">æœ¬åœ°è°ƒè¯•</h4>
<p>Hugo ä¼šç”Ÿæˆé™æ€ç½‘é¡µï¼Œæœ¬åœ°å¯ä»¥ä½¿ç”¨ <code>hugo server</code> è¿›è¡Œå®æ—¶è°ƒè¯•é¢„è§ˆï¼Œæ— é¡»æ¯æ¬¡é‡æ–°ç”Ÿæˆã€‚æ³¨æ„ï¼Œpost æ–‡ä»¶é‡Œï¼Œ<code>draft=true</code> çš„ post ä¸ä¼šè¢«æ¸²æŸ“ï¼Œéœ€è¦ä½¿ç”¨ <code>hugo server -D</code> æ‰èƒ½æ˜¾ç¤ºå‡ºæ¥ã€‚</p>
<p>è¿è¡ŒæœåŠ¡åï¼Œå¯ä»¥é€šè¿‡æµè§ˆå™¨ <code>http://localhost:1313</code> è®¿é—®é¢„è§ˆç½‘é¡µ</p>
<h2 id="gitpage-å‘å¸ƒ">GitPage å‘å¸ƒ</h2>
<h3 id="ä»“åº“æ„å»º">ä»“åº“æ„å»º</h3>
<p>åœ¨ github ä¸­åˆ›å»ºä¸€ä¸ª&lt;USER_NAME&gt;.github.io çš„ç‰¹æ®Šä»“åº“ï¼Œç„¶åå°†é…ç½®æ–‡ä»¶ <code>config.toml</code> ä¸­çš„ <code>baseURL</code> æ”¹ä¸ºè‡ªå·±çš„è‡ªå®šä¹‰åŸŸåï¼Œè¿™æ ·åšå®¢å°±èƒ½è®¿é—®å¯¹åº”çš„ gitpage ç½‘é¡µã€‚</p>
<p>å®Œæˆä¸Šè¿°å‡†å¤‡å·¥ä½œåï¼Œæˆ‘ä»¬ç°åœ¨å·²ç»å¯ä»¥é€šè¿‡è‡ªå®šä¹‰åŸŸåæ¥è®¿é—®æˆ‘ä»¬çš„ GitHub Pages é¡µé¢äº†ï¼Œç›®å‰å› ä¸ºé¡¹ç›®ä»“åº“æ˜¯ç©ºçš„ï¼Œè®¿é—®åä¼šæŠ¥Â <code>404</code>Â é¡µé¢ã€‚</p>
<p>æˆ‘ä»¬å¸Œæœ› Hugo ç”Ÿæˆçš„é™æ€ç½‘ç«™èƒ½é€šè¿‡ GitHub Pages æœåŠ¡è¿›è¡Œæ‰˜ç®¡ï¼Œè€Œæ— éœ€è‡ªå·±ç»´æŠ¤æœåŠ¡ï¼Œæ›´ç¨³å®šã€å®‰å…¨ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸Šä¼  Hugo ç”Ÿæˆçš„é™æ€ç½‘é¡µæ–‡ä»¶è‡³ GitHub Page é¡¹ç›®ä»“åº“ã€‚</p>
<h3 id="æ‰‹åŠ¨å‘å¸ƒ">æ‰‹åŠ¨å‘å¸ƒ</h3>
<p>å¯ä»¥æ‰§è¡Œ <code>hugo</code> åœ¨æœ¬åœ°çš„ public ç›®å½•ä¸‹åˆ›å»ºé™æ€ç½‘é¡µï¼Œé€šè¿‡å°† <code>public</code> ç›®å½•åˆå§‹åŒ–ä¸º git ä»“åº“ï¼Œå¹¶å…³è” gitpage è¿œç¨‹ä»“åº“ï¼Œå°±å¯ä»¥æ¨é€ç½‘é¡µé™æ€æ–‡ä»¶ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">git init
</span></span><span class="line"><span class="cl">git remote add origin git@github.com:&lt;username&gt;/&lt;username&gt;.github.io
</span></span><span class="line"><span class="cl">git add .
</span></span><span class="line"><span class="cl">git commit -m <span class="s2">&#34;add test&#34;</span>
</span></span><span class="line"><span class="cl">git push origin main
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="è‡ªåŠ¨å‘å¸ƒ">è‡ªåŠ¨å‘å¸ƒ</h3>
<p>æˆ‘ä»¬çš„åšå®¢åŸºäº GitHub ä¸ GitHub Pagesï¼Œå¯ä»¥é€šè¿‡å®˜æ–¹æä¾›çš„ GitHub Action è¿›è¡Œ CI è‡ªåŠ¨å‘å¸ƒã€‚</p>
<p>åœ¨ä»“åº“ç›®å½•ä¸‹å»ºç«‹ <code>.github/workflows/deploy.yml</code>ï¼Œè‡ªåŠ¨å‘å¸ƒç¤ºä¾‹å¦‚ä¸‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">github pages</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">on</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">push</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">main </span><span class="w"> </span><span class="c"># Set a branch to deploy</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">pull_request</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">workflow_dispatch</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">jobs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">deploy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l">ubuntu-22.04</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">steps</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">actions/checkout@v3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">submodules</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">  </span><span class="c"># Fetch Hugo themes (true OR recursive)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">fetch-depth</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">    </span><span class="c"># Fetch all history for .GitInfo and .Lastmod</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Setup Hugo</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">peaceiris/actions-hugo@v2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">hugo-version</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;latest&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">extended</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">actions/cache@v2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/tmp/hugo_cache</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">${{ runner.os }}-hugomod-${{ hashFiles(&#39;**/go.sum&#39;) }}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">restore-keys</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">            </span><span class="w">            </span><span class="l">${{ runner.os }}-hugomod-</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Build Web</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l">hugo --minify</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Deploy Web</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">peaceiris/actions-gh-pages@v3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">PERSONAL_TOKEN</span><span class="p">:</span><span class="w"> </span><span class="l">${{ secrets.PERSONAL_TOKEN }}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">external_repository</span><span class="p">:</span><span class="w"> </span><span class="l">NIL-zhuang/nil-zhuang.github.io</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">publish_branch</span><span class="p">:</span><span class="w"> </span><span class="l">main</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">publish_dir</span><span class="p">:</span><span class="w"> </span><span class="l">./public</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">commit_message</span><span class="p">:</span><span class="w"> </span><span class="l">${{ github.event.head_commit.message }}</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åæˆ‘ä»¬éœ€è¦å»ºç«‹ä¸€ä¸ª <code>PERSONAL_TOKEN</code>ï¼Œå¼€å¯ <code>repo</code> ä¸ <code>workflow</code> æƒé™ï¼Œåœ¨ä»“åº“çš„ Action Secrets ä¸­æ·»åŠ å¯¹åº” Tokenï¼Œå°±å¯ä»¥è§¦å‘æ¨é€äº†ã€‚</p>
]]></description></item><item><title>Sparké›†ç¾¤æ­å»º</title><link>https://nil-zhuang.github.io/2022/10/spark_build/</link><pubDate>Fri, 28 Oct 2022 15:12:56 +0800</pubDate><author>Nil Zhuang</author><guid>https://nil-zhuang.github.io/2022/10/spark_build/</guid><description><![CDATA[<h1 id="spark_build">spark_build</h1>
<h2 id="å†™åœ¨å‰é¢">å†™åœ¨å‰é¢</h2>
<p>æœ¬æ–‡æ¡£æ˜¯ä¿©å« nil å’Œ mark çš„é“ä»”å’Œ yyds æä¼ è‰ºè€å¸ˆï¼Œåœ¨ yyds çš„åŠå…¬å®¤å€’è…¾ä¸€æ•´ä¸ªä¸‹åˆä¹‹åï¼Œæ€»ç»“å‡ºçš„è¡€æ³ªæ•™è®­ã€‚</p>
<p>æœ¬æ–‡æ˜¯åœ¨ manjaro å’Œ Ubuntu ä¸¤ä¸ª Linux å‘è¡Œç‰ˆçš„ä¸ªäºº PC ä¸Šï¼Œå¯åŠ¨ hadoop hdfs é›†ç¾¤å’Œ spark é›†ç¾¤çš„æ“ä½œè¿‡ç¨‹ã€‚æ¶‰åŠåˆ°ä¸åŒ <strong>username</strong> å’Œä¸åŒ <strong>hostname</strong> çš„ç‰©ç†æœºï¼Œåœ¨çœŸå®ç½‘ç»œæƒ…å†µä¸‹ (å®¿èˆè·¯ç”±å™¨å±€åŸŸç½‘) çš„é…ç½®æ“ä½œï¼Œä»…ä¾›å‚è€ƒã€‚</p>
<!-- more -->
<p>å…¶ä¸­ DataNode æœºå™¨çš„é…ç½®å¦‚ä¸‹ï¼ˆå¤¹å¸¦ç§è´§ï¼Œæ¬¢è¿åŠ å…¥ manjaro é‚ªæ•™ï¼‰ã€‚æœ¬æ–‡æ¡£æ‰€æœ‰å‘½ä»¤éƒ½å¯ä»¥åœ¨ manjaro/ArchLinux ä¸‹æ‰§è¡Œï¼ŒUbuntu æˆ–å…¶ä»–ç³»ç»Ÿè¯·è‡ªè¡Œå¯»æ‰¾å¯¹ç…§å‘½ä»¤</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">OS: Manjaro 20.1.1 Mikah
</span></span><span class="line"><span class="cl">Kernel: x86_64 Linux 5.8.11-1-MANJARO
</span></span><span class="line"><span class="cl">Shell: zsh 5.8
</span></span><span class="line"><span class="cl">CPU: Intel Core i7-8550U @ 8x 4GHz
</span></span><span class="line"><span class="cl">Disk: 196G / 482G (42%)
</span></span><span class="line"><span class="cl">GPU: Mesa Intel(R) UHD Graphics 620 (KBL GT2)
</span></span><span class="line"><span class="cl">RAM: 5227MiB / 15896MiB
</span></span></code></pre></td></tr></table>
</div>
</div><table>
<thead>
<tr>
<th style="text-align:center">æœºå™¨ç±»å‹</th>
<th style="text-align:center">å±€åŸŸç½‘ IP</th>
<th style="text-align:center">hostname</th>
<th style="text-align:center">username</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">master/slaver</td>
<td style="text-align:center">192.168.1.103</td>
<td style="text-align:center">mark-pc</td>
<td style="text-align:center">mark</td>
</tr>
<tr>
<td style="text-align:center">slaver</td>
<td style="text-align:center">192.168.1.104</td>
<td style="text-align:center">nil-PC</td>
<td style="text-align:center">nil</td>
</tr>
</tbody>
</table>
<p>é›†ç¾¤ç¯å¢ƒæ˜¯</p>
<ul>
<li>Hadoop 2.7.7</li>
<li>Spark version 3.0.1</li>
<li>Scala version 2.12.10</li>
<li>OpenJDK 64-Bit Server VM, Java 1.8.0_265</li>
</ul>
<h2 id="æ“ä½œæµç¨‹">æ“ä½œæµç¨‹</h2>
<ol>
<li>åˆ›å»ºé•œåƒ or è¿˜åŸç‚¹ (å¯é€‰ï¼Œæ¨è)</li>
<li>æ­å»º ssh ç¯å¢ƒ</li>
<li>ä¿®æ”¹ hosts æ–‡ä»¶</li>
<li>å®‰è£… java ç¯å¢ƒ</li>
<li>å®‰è£… hadoop</li>
<li>å®‰è£… spark</li>
<li>å¯åŠ¨é›†ç¾¤ï¼Œè¿è¡Œå‘½ä»¤</li>
<li>å¼€æ±½æ°´åº†ç¥</li>
</ol>
<h2 id="æ­å»º-ssh-ç¯å¢ƒ">æ­å»º ssh ç¯å¢ƒ</h2>
<p>é¦–å…ˆé…ç½®å¥½è‡ªå·±çš„ ssh ç¯å¢ƒ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">ssh-keygen -t rsa
</span></span><span class="line"><span class="cl">chmod <span class="m">600</span> ~/.ssh/authorized_keys
</span></span><span class="line"><span class="cl">cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">æ–‡ä»¶ç›®å½•å¦‚ä¸‹
</span></span><span class="line"><span class="cl">.ssh
</span></span><span class="line"><span class="cl">â”œâ”€â”€ authorized_keys
</span></span><span class="line"><span class="cl">â”œâ”€â”€ config
</span></span><span class="line"><span class="cl">â”œâ”€â”€ id_rsa
</span></span><span class="line"><span class="cl">â”œâ”€â”€ id_rsa.pub
</span></span><span class="line"><span class="cl">â””â”€â”€ known_hosts
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç”¨ <code>ifconfig</code> æˆ– <code>ip address show</code> æŸ¥çœ‹ ip åœ°å€åï¼Œping ä¸€ä¸‹ä½ è¦è¿æ¥çš„ç”µè„‘çš„ ipï¼Œä¿è¯ç½‘ç»œé€šç•…ã€‚</p>
<ul>
<li>å…å¯†ç™»å½•ï¼šå°†å…¶ä»–æœºå™¨çš„ id_rsa.pub é‡Œçš„å†…å®¹æ·»åŠ åˆ°æœ¬æœºçš„ authorized_keys é‡Œ (ç”¨ <code>cat &gt;&gt;</code> è¿½åŠ )</li>
</ul>
<p>æµ‹è¯• ssh è¿æ¥ã€‚å¦‚æœå‡ºç° <code>sshï¼šconnect to host port 22ï¼šConnection refused</code>ï¼Œé‚£è®°å¾—è¿è¡Œå‘½ä»¤ <code>systemctl start sshd</code> æ‰“å¼€ sshd.serviceã€‚</p>
<p>å¦‚æœæˆ‘åœ¨ nil-PC ä¸Šè¿æ¥ mark-pcï¼Œç›´æ¥ <code>ssh 192.168.1.103</code> ä¼šå¤±è´¥ï¼Œå› ä¸ºçš„ç™»å½•ç”¨æˆ·åæ˜¯ nilï¼Œè€Œ mark-pc é‡Œæ²¡æœ‰ nil è¿™ä¸ªç”¨æˆ·ã€‚æ­£ç¡®åšæ³•æ˜¯ <code>ssh mark@192.168.1.103</code>ï¼Œæ¥æ”¶å¯¹æ–¹ fingerprint åˆ° known_hosts é‡Œåï¼Œå°±å¯ä»¥å…å¯†ç™»å½•ã€‚</p>
<h2 id="ä¿®æ”¹-hosts-æ–‡ä»¶">ä¿®æ”¹ hosts æ–‡ä»¶</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">è¿™æ˜¯ä¸ªæ —å­
</span></span><span class="line"><span class="cl"># Host addresses
</span></span><span class="line"><span class="cl"># 127.0.0.1  localhost
</span></span><span class="line"><span class="cl"># 127.0.1.1  nil-PC
</span></span><span class="line"><span class="cl">::1        localhost ip6-localhost ip6-loopback
</span></span><span class="line"><span class="cl">ff02::1    ip6-allnodes
</span></span><span class="line"><span class="cl">ff02::2    ip6-allrouters
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">192.168.1.103 mark-pc
</span></span><span class="line"><span class="cl">192.168.1.104 nil-PC
</span></span></code></pre></td></tr></table>
</div>
</div><p>Noticeï¼š</p>
<ol>
<li>å°† 127.0.0.1 å’Œ 127.0.1.1 çš„è·¯å¾„éƒ½å»æ‰ï¼Œå¦åˆ™åœ¨ hadoop å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šä¼˜å…ˆåœ¨ localhost æäº¤å‡ºé”™</li>
<li>åœ¨ ip åé¢ï¼Œè¦å†™çš„æ˜¯ <strong>hostname</strong>ï¼Œå¯ä»¥æ‰§è¡Œ <code>hostname</code> çœ‹åˆ°ï¼Œ<strong>ä¸æ˜¯ username</strong></li>
<li>åœ¨ä¿®æ”¹å®Œåï¼Œä¸€å®šè¦åˆ·æ–° hostsï¼Œè¿è¡Œå‘½ä»¤ <code>systemctl restart NetworkManager</code> æˆ–æ˜¯æ³¨é”€é‡å¯</li>
</ol>
<p>ä¿®æ”¹åæ£€æŸ¥ï¼š</p>
<ol>
<li>ping mark-pc æˆåŠŸ</li>
<li>ssh mark@mark-pc å¯ä»¥ç™»å½•</li>
</ol>
<h2 id="å®‰è£…-java-ç¯å¢ƒ">å®‰è£… java ç¯å¢ƒ</h2>
<p>æ­£å¸¸å®‰è£… java8ï¼Œjava home ä¸å‡ºæ„å¤–åœ¨ <code>/usr/lib/jvm/</code> ä¸‹ï¼Œæœ¬æœºè·¯å¾„æ˜¯ <code>/usr/lib/jvm/java-8-openjdk/</code>ï¼Œå¯ä»¥åœ¨ bin ç›®å½•ä¸‹æ‰§è¡Œ <code>./javac -version</code> çœ‹åˆ° java ç‰ˆæœ¬æ˜¯ javac 1.8.0_265(å¥½åƒ 1.8.0 åçš„å°å°ç‰ˆæœ¬ä¸å½±å“ï¼Œmark æ˜¯ 261 ä¹Ÿè¿è¡Œæ­£å¸¸)</p>
<p>å°† java æ·»åŠ è‡³ç¯å¢ƒå˜é‡ï¼Œåœ¨/etc/profile æ–‡ä»¶è¿½åŠ å¦‚ä¸‹å†…å®¹ (å…·ä½“å†…å®¹å› äººè€Œå¼‚)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">JAVA_HOME</span><span class="o">=</span>/usr/lib/jvm/java-8-openjdk
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">CLASSPATH</span><span class="o">=</span>:<span class="nv">$JAVA_HOME</span>/lib:<span class="nv">$JAVA_HOME</span>/jre/lib:<span class="nv">$CLASSPATH</span>
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$JAVA_HOME</span>/bin:<span class="nv">$JAVA_HOME</span>/jre/bin:<span class="nv">$PATH</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¯ä¸€æ¬¡ä¿®æ”¹åéƒ½è¦ <code>source /etc/profile</code> åˆ·æ–°ç¯å¢ƒå˜é‡ã€‚åœ¨å‘½ä»¤è¡Œè¾“å…¥ <code>echo $JAVA_HOME</code> è¿›è¡Œæ£€éªŒ</p>
<h2 id="å®‰è£…-hadoop">å®‰è£… hadoop</h2>
<ol>
<li>é€‰æ‹©äº† hadoop-2.7.7ï¼Œä¹Ÿå¯ä»¥é€‰æœ€æ–°æ–‡ä»¶ã€‚æˆ‘å°†å…¶è§£å‹åœ¨äº†/usr/lib/hadoop-2.7.7 ä¸‹ï¼ˆè¿™ä¸ªéšä¾¿ï¼Œä½†æ˜¯ä¸å»ºè®®æ”¾åœ¨/home é‡Œé¢ï¼Œæ¶‰åŠåˆ°ç”¨æˆ·æƒé™ï¼‰</li>
</ol>
<p>notice:<strong>æ‰€æœ‰æœºå™¨ä¸Šï¼Œhadoop å’Œ spark çš„ç»å¯¹ä½ç½®å’Œå†…å®¹è¦ä¿æŒä¸¥æ ¼ä¸€è‡´</strong></p>
<ol>
<li>å°† hadoop æ·»åŠ åˆ°ç¯å¢ƒå˜é‡ï¼Œè¿½åŠ äº†ï¼ˆå…·ä½“å†…å®¹å› äººè€Œå¼‚ï¼‰</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">HADOOP_HOME</span><span class="o">=</span>/usr/lib/hadoop-2.7.7
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$HADOOP_HOME</span>/bin:<span class="nv">$HADOOP_HOME</span>/sbin
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>éªŒè¯å®‰è£…ï¼Œæ‰§è¡Œ <code>hadoop version</code></li>
</ol>
<h3 id="ä¿®æ”¹é…ç½®æ–‡ä»¶">ä¿®æ”¹é…ç½®æ–‡ä»¶</h3>
<p>æ³¨æ„ï¼Œè¿™é‡Œçš„ <strong>mark-pc éƒ½è¦æ”¹æˆæœŸæœ›ä½œä¸º master çš„ç”µè„‘çš„ hostname</strong>ï¼Œ<strong>ç»å¯¹è·¯å¾„ä¹Ÿè¦åšç›¸åº”çš„ä¿®æ”¹</strong></p>
<ol>
<li>åœ¨ $HADOOP_HOME ä¸‹æ·»åŠ ç›®å½• tmp, hdfs, hdfs/name, hdfs/data</li>
<li>$HADOOP_HOME/etc/hadoop/core-site.xml</li>
</ol>
<p>æ³¨æ„ï¼Œåœ¨é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œ<strong>fs.defaultFS è¦å†™é›†ç¾¤é‡Œ namenode çš„ ip å’Œç«¯å£</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;configuration&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="c">&lt;!-- æŒ‡å®šnamenodeçš„åœ°å€ --&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;property&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;name&gt;</span>fs.defaultFS<span class="nt">&lt;/name&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;value&gt;</span>hdfs://mark-pc:9000<span class="nt">&lt;/value&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/property&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;property&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- ç”¨æ¥æŒ‡å®šä½¿ç”¨hadoopæ—¶äº§ç”Ÿæ–‡ä»¶çš„å­˜æ”¾ç›®å½• --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;name&gt;</span>hadoop.tmp.dir<span class="nt">&lt;/name&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;value&gt;</span>/usr/lib/hadoop-2.7.7/tmp<span class="nt">&lt;/value&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/property&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/configuration&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>$HADOOP_HOME/etc/hadoop/hdfs-site.xml</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;configuration&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;property&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;name&gt;</span>dfs.namenode.secondary.http-address<span class="nt">&lt;/name&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;value&gt;</span>mark-pc:50090<span class="nt">&lt;/value&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/property&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;property&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="c">&lt;!-- æŒ‡å®šhdfsä¿å­˜æ•°æ®çš„å‰¯æœ¬æ•°é‡ --&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;name&gt;</span>dfs.replication<span class="nt">&lt;/name&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;value&gt;</span>1<span class="nt">&lt;/value&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/property&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;property&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;name&gt;</span>dfs.namenode.name.dir<span class="nt">&lt;/name&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;value&gt;</span>file:/usr/lib/hadoop-2.7.7/hdfs/name<span class="nt">&lt;/value&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/property&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;property&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;name&gt;</span>dfs.datanode.data.dir<span class="nt">&lt;/name&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;value&gt;</span>file:/usr/lib/hadoop-2.7.7/hdfs/data<span class="nt">&lt;/value&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/property&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/configuration&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>$HADOOP_HOME/etc/hadoop/slaves</li>
</ol>
<p>æ³¨æ„ï¼Œåªæœ‰è¿™é‡Œæ˜¯è¦å†™ <strong>ç”¨æˆ·å@ä¸»æœºå</strong> çš„ï¼Œå¦åˆ™ namenode åœ¨ç™»å½• datanode çš„æ—¶å€™ï¼Œç”¨çš„æ˜¯ namenode å½“å‰çš„ç”¨æˆ·åï¼Œé€ æˆå‡ºé”™</p>
<p>æ³¨æ„ï¼Œslaves æ–‡ä»¶åªå­˜ datanode çš„ hostï¼Œå½“ç„¶é‰´äº namenode éƒ½ä¸å¹²å•¥äº‹ï¼Œå»ºè®®æŠŠ master ä¸»æœºä¹Ÿä½œä¸º slaver ä¸€èµ·æ‰§è¡Œè®¡ç®—ä»»åŠ¡ï¼Œç¬¦åˆç¤¾ä¼šä¸»ä¹‰æ ¸å¿ƒä»·å€¼è§‚ï¼ˆé›¾ï¼‰</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">mark@mark-pc
</span></span><span class="line"><span class="cl">nil@nil-PC
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="éªŒè¯-hadoop-é›†ç¾¤å®‰è£…æˆåŠŸ">éªŒè¯ hadoop é›†ç¾¤å®‰è£…æˆåŠŸ</h3>
<ol>
<li>æ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿ <code>hdfs namenode -format</code>ï¼Œçœ‹åˆ°æœ€åå‡ è¡Œæœ‰ ExitCode=0 è¿™æ ·çš„å­—çœ¼å°±è¯´æ˜æ ¼å¼åŒ–æˆåŠŸäº†ï¼Œå¦‚æœæœ‰è¯¯ï¼Œå¯ä»¥æ£€æŸ¥ä¸€ä¸‹ xml æ–‡ä»¶çš„é…ç½®</li>
<li>åœ¨ $HADOOP_HOME/sbin ä¸‹è¿è¡Œ start-all.shï¼Œå”¤èµ· namenode å’Œ datanodeï¼Œåˆ†åˆ«åœ¨ master å’Œ slaver ä¸Šæ‰§è¡Œ <code>jps</code>ï¼Œå¦‚æœçœ‹åˆ°ä»¥ä¸‹å†…å®¹å°±è¯´æ˜æˆåŠŸäº†</li>
</ol>
<p>master ä¸Šçœ‹åˆ°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">xxxx Jps
</span></span><span class="line"><span class="cl">xxxx SecondaryNameNode
</span></span><span class="line"><span class="cl">xxxx NameNode
</span></span><span class="line"><span class="cl">xxxx DataNode
</span></span><span class="line"><span class="cl">xxxx NodeManager
</span></span><span class="line"><span class="cl">xxxx ResourceManager (ä¼¼ä¹è¿™ä¸ªæ˜¯å¯æœ‰å¯æ— )
</span></span></code></pre></td></tr></table>
</div>
</div><p>slaver ä¸Šçœ‹åˆ°</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">xxxx Jps
</span></span><span class="line"><span class="cl">xxxx DataNode
</span></span><span class="line"><span class="cl">xxxx NodeManager
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·å°±è¯´æ˜ hadoop é›†ç¾¤è¿è¡ŒæˆåŠŸäº†</p>
<p>Noticeï¼šå¦‚æœåœ¨ start-all çš„æ—¶å€™å‘ç° datanode æ²¡æœ‰è¢«å”¤èµ·ï¼Œå¤§æ¦‚ç‡æ˜¯ datanode çš„ id å’Œ master ä¸Šçš„ id ä¸åŒï¼Œå› ä¸ºä½ æ‰§è¡Œ format å‘½ä»¤å¤šæ¬¡ã€‚è§£å†³æ–¹æ¡ˆæ˜¯åœ¨æ‰€æœ‰çš„æœºå™¨ä¸Šéƒ½åˆ é™¤ $HADOOP_HOME/hdfs/data/current æ–‡ä»¶å¤¹ï¼Œé‡æ–° format å³å¯ã€‚</p>
<h3 id="éªŒè¯-hadoop-é›†ç¾¤è¿è¡ŒçŠ¶æ€">éªŒè¯ hadoop é›†ç¾¤è¿è¡ŒçŠ¶æ€</h3>
<ol>
<li>è®¿é—® <code>http://192.168.1.103:50070</code> (è¿™é‡Œçš„ ip æ˜¯ master çš„ ip åœ°å€)ï¼Œçœ‹åˆ° DataNodes æ•°é‡ç¬¦åˆ</li>
<li>åœ¨ master ä¸Šè¿è¡Œ <code>hdfs dfs -mkdir /hadoop</code> åï¼Œå¯ä»¥åœ¨ç½‘é¡µçš„æ–‡ä»¶ç®¡ç†é¡µé¢ä¸Šæ‰¾åˆ°æ–°å»ºçš„ç›®å½•ï¼Œå°±å¤§åŠŸå‘Šæˆäº†ï¼</li>
</ol>
<h2 id="å®‰è£…-spark">å®‰è£… spark</h2>
<ol>
<li>å…ˆè£…ä¸€ä¸ª scalaï¼Œé…ç½®å¥½ SCALA_HOMEï¼Œè¿è¡Œ <code>scala</code> çœ‹åˆ° repl å³å¯</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">SCALA_HOME</span><span class="o">=</span>/usr/lib/scala-2.13.3
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$SCALA_HOME</span>/bin
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>å°† spark ä¸€æ ·çš„è§£å‹åˆ°/usr/lib ä¸‹ï¼Œé…ç½® SPARK_HOME</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">SPARK_HOME</span><span class="o">=</span>/usr/lib/spark-3.0.1-bin-hadoop2.7
</span></span><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$SPARK_HOME</span>/bin
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>$SPARK_HOME/conf/slaves</li>
</ol>
<p>å’Œ $HADOOP_HOME/etc/hadoop/slaves å†…å®¹æ˜¯ä¸€æ ·çš„</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">mark@mark-pc
</span></span><span class="line"><span class="cl">nil@nil-PC
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>**å…ˆå¯åŠ¨ hadoop!**å¯åŠ¨ Sparkï¼Œåœ¨ SPARK_HOME çš„ sbin ç›®å½•ä¸‹æ‰§è¡Œ start-all.shï¼Œä¼šå”¤èµ·æ‰€æœ‰çš„èŠ‚ç‚¹ï¼Œæ­¤æ—¶ master ä¸­è¿è¡Œ jps åœ¨åŸæœ‰åŸºç¡€ä¸Šæ–°å¢äº† Masterï¼Œslaver é‡Œæ–°å¢äº† Worker</li>
<li>è¿›å…¥ <code>http://192.168.1.103:8080</code> çœ‹åˆ° spark ç›‘æ§ç½‘é¡µï¼Œå¹¶ä¸” slaver æ•°é‡æ­£å¸¸ï¼Œå°±è¯´æ˜æ­£å¸¸å¯åŠ¨</li>
</ol>
<h2 id="å¯åŠ¨é›†ç¾¤è¿è¡Œå‘½ä»¤">å¯åŠ¨é›†ç¾¤ï¼Œè¿è¡Œå‘½ä»¤</h2>
<ol>
<li>è¿è¡Œä»£ç  <code>$SPARK_HOME/bin/run-example SparkPi 10</code>ï¼Œèƒ½å¤Ÿæ­£ç¡®æ‰§è¡Œè®¡ç®—å‡º $\pi$ï¼Œè¯´æ˜æœ¬åœ°è¿è¡Œæ˜¯ ok çš„</li>
<li>å‘é›†ç¾¤æäº¤ä»»åŠ¡ï¼Œæ‰§è¡Œ</li>
</ol>
<p><code>./spark-submit --class org.apache.spark.examples.JavaSparkPi --master spark://mark-pc:7077 ../examples/jars/spark-examples_2.12-3.0.1.jar</code></p>
<p>åœ¨ 8088 ç«¯å£çœ‹åˆ° application å’Œè¿è¡Œçš„æœºå™¨ï¼Œé‚£å°±å¤§åŠŸå‘Šæˆå•¦</p>
]]></description></item><item><title>Gitä½¿ç”¨æ•™ç¨‹</title><link>https://nil-zhuang.github.io/2022/10/git/</link><pubDate>Fri, 28 Oct 2022 15:12:02 +0800</pubDate><author>Nil Zhuang</author><guid>https://nil-zhuang.github.io/2022/10/git/</guid><description><![CDATA[<h1 id="git-ä½¿ç”¨æ•™ç¨‹">Git ä½¿ç”¨æ•™ç¨‹</h1>
<p>è¿™ç¯‡æ–‡ç« è®°å½•äº† zzy å› ä¸ºåœ¨ git æ“ä½œä¸Šç–¯ç‹‚ç¿»è½¦æœ€åé€‰æ‹©å»è¿‡ä¸€é Learn Git Branching</p>
<h2 id="åŸºç¡€ç¯‡">åŸºç¡€ç¯‡</h2>
<h3 id="commit">Commit</h3>
<p>Git ä»“åº“ä¸­çš„æäº¤è®°å½•ä¿å­˜çš„æ˜¯ä½ çš„ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶çš„å¿«ç…§ï¼Œå°±åƒæ˜¯æŠŠæ•´ä¸ªç›®å½•å¤åˆ¶ï¼Œç„¶åå†ç²˜è´´ä¸€æ ·ï¼Œä½†æ¯”å¤åˆ¶ç²˜è´´ä¼˜é›…è®¸å¤šï¼</p>
<p>Git å¸Œæœ›æäº¤è®°å½•å°½å¯èƒ½åœ°è½»é‡ï¼Œå› æ­¤åœ¨ä½ æ¯æ¬¡è¿›è¡Œæäº¤æ—¶ï¼Œå®ƒå¹¶ä¸ä¼šç›²ç›®åœ°å¤åˆ¶æ•´ä¸ªç›®å½•ã€‚æ¡ä»¶å…è®¸çš„æƒ…å†µä¸‹ï¼Œå®ƒä¼šå°†å½“å‰ç‰ˆæœ¬ä¸ä»“åº“ä¸­çš„ä¸Šä¸€ä¸ªç‰ˆæœ¬è¿›è¡Œå¯¹æ¯”ï¼Œå¹¶æŠŠæ‰€æœ‰çš„å·®å¼‚æ‰“åŒ…åˆ°ä¸€èµ·ä½œä¸ºä¸€ä¸ªæäº¤è®°å½•ã€‚</p>
<p>Git è¿˜ä¿å­˜äº†æäº¤çš„å†å²è®°å½•ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå¤§å¤šæ•°æäº¤è®°å½•çš„ä¸Šé¢éƒ½æœ‰çˆ¶èŠ‚ç‚¹çš„åŸå› â€”â€”æˆ‘ä»¬ä¼šåœ¨å›¾ç¤ºä¸­ç”¨ç®­å¤´æ¥è¡¨ç¤ºè¿™ç§å…³ç³»ã€‚å¯¹äºé¡¹ç›®ç»„çš„æˆå‘˜æ¥è¯´ï¼Œç»´æŠ¤æäº¤å†å²å¯¹å¤§å®¶éƒ½æœ‰å¥½å¤„ã€‚</p>
<h3 id="branch">Branch</h3>
<p>Git çš„åˆ†æ”¯ä¹Ÿéå¸¸è½»é‡ã€‚å®ƒä»¬åªæ˜¯ç®€å•åœ°æŒ‡å‘æŸä¸ªæäº¤çºªå½•â€”â€”ä»…æ­¤è€Œå·²ã€‚æ‰€ä»¥è®¸å¤š Git çˆ±å¥½è€…ä¼ é¢‚ï¼š</p>
<p><strong>æ—©å»ºåˆ†æ”¯ï¼å¤šç”¨åˆ†æ”¯ï¼</strong></p>
<p>è¿™æ˜¯å› ä¸ºå³ä½¿åˆ›å»ºå†å¤šçš„åˆ†æ”¯ä¹Ÿä¸ä¼šé€ æˆå‚¨å­˜æˆ–å†…å­˜ä¸Šçš„å¼€é”€ï¼Œå¹¶ä¸”æŒ‰é€»è¾‘åˆ†è§£å·¥ä½œåˆ°ä¸åŒçš„åˆ†æ”¯è¦æ¯”ç»´æŠ¤é‚£äº›ç‰¹åˆ«è‡ƒè‚¿çš„åˆ†æ”¯ç®€å•å¤šäº†ã€‚</p>
<p>åœ¨å°†åˆ†æ”¯å’Œæäº¤è®°å½•ç»“åˆèµ·æ¥åï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°ä¸¤è€…å¦‚ä½•åä½œã€‚ç°åœ¨åªè¦è®°ä½ä½¿ç”¨åˆ†æ”¯å…¶å®å°±ç›¸å½“äºåœ¨è¯´ï¼šâ€œæˆ‘æƒ³åŸºäºè¿™ä¸ªæäº¤ä»¥åŠå®ƒæ‰€æœ‰çš„çˆ¶æäº¤è¿›è¡Œæ–°çš„å·¥ä½œã€‚â€</p>
<p><code>git branch newImage</code> å°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ªæ–°åˆ†æ”¯ï¼Œç„¶åè¦ checkout åˆ°æ–°åˆ†æ”¯ä¸Šï¼Œä¹Ÿå¯ä»¥ç›´æ¥ <code>git checkout -b newImage</code> åˆ›å»ºå¹¶åˆ‡æ¢åˆ†æ”¯</p>
<h3 id="merge">Merge</h3>
<p>æ¥ä¸‹æ¥å’±ä»¬çœ‹çœ‹å¦‚ä½•å°†ä¸¤ä¸ªåˆ†æ”¯åˆå¹¶åˆ°ä¸€èµ·ã€‚å°±æ˜¯è¯´æˆ‘ä»¬æ–°å»ºä¸€ä¸ªåˆ†æ”¯ï¼Œåœ¨å…¶ä¸Šå¼€å‘æŸä¸ªæ–°åŠŸèƒ½ï¼Œå¼€å‘å®Œæˆåå†åˆå¹¶å›ä¸»çº¿ã€‚</p>
<p>å’±ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹ç¬¬ä¸€ç§æ–¹æ³•â€”â€”<code>git merge</code>ã€‚åœ¨ Git ä¸­åˆå¹¶ä¸¤ä¸ªåˆ†æ”¯æ—¶ä¼šäº§ç”Ÿä¸€ä¸ªç‰¹æ®Šçš„æäº¤è®°å½•ï¼Œå®ƒæœ‰ä¸¤ä¸ªçˆ¶èŠ‚ç‚¹ã€‚ç¿»è¯‘æˆè‡ªç„¶è¯­è¨€ç›¸å½“äºï¼šâ€œæˆ‘è¦æŠŠè¿™ä¸¤ä¸ªçˆ¶èŠ‚ç‚¹æœ¬èº«åŠå®ƒä»¬æ‰€æœ‰çš„ç¥–å…ˆéƒ½åŒ…å«è¿›æ¥ã€‚â€</p>
<p>æˆ‘ä»¬å‡†å¤‡äº†ä¸¤ä¸ªåˆ†æ”¯ï¼Œæ¯ä¸ªåˆ†æ”¯ä¸Šå„æœ‰ä¸€ä¸ªç‹¬æœ‰çš„æäº¤ã€‚è¿™æ„å‘³ç€æ²¡æœ‰ä¸€ä¸ªåˆ†æ”¯åŒ…å«äº†æˆ‘ä»¬ä¿®æ”¹çš„æ‰€æœ‰å†…å®¹ã€‚å’±ä»¬é€šè¿‡åˆå¹¶è¿™ä¸¤ä¸ªåˆ†æ”¯æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚è¦æŠŠ bugFix åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ï¼Œå°±æ˜¯ <code>git merge bugFix</code></p>
<p>é¦–å…ˆï¼Œ<code>master</code> ç°åœ¨æŒ‡å‘äº†ä¸€ä¸ªæ‹¥æœ‰ä¸¤ä¸ªçˆ¶èŠ‚ç‚¹çš„æäº¤è®°å½•ã€‚å‡å¦‚ä» <code>master</code> å¼€å§‹æ²¿ç€ç®­å¤´å‘ä¸Šçœ‹ï¼Œåœ¨åˆ°è¾¾èµ·ç‚¹çš„è·¯ä¸Šä¼šç»è¿‡æ‰€æœ‰çš„æäº¤è®°å½•ã€‚è¿™æ„å‘³ç€ <code>master</code> åŒ…å«äº†å¯¹ä»£ç åº“çš„æ‰€æœ‰ä¿®æ”¹</p>
<p>å¦‚æœæ‰§è¡Œ <code>git checkout bugFix; git merge master</code>ï¼Œåªä¼šæ”¹å˜ bugFix çš„æŒ‡å‘ï¼Œè€Œä¸ä¼šæœ‰æ–°çš„å†…å®¹äº§ç”Ÿã€‚å› ä¸º <code>master</code> ç»§æ‰¿è‡ª <code>bugFix</code>ï¼ŒGit ä»€ä¹ˆéƒ½ä¸ç”¨åšï¼Œåªæ˜¯ç®€å•åœ°æŠŠ <code>bugFix</code> ç§»åŠ¨åˆ° <code>master</code> æ‰€æŒ‡å‘çš„é‚£ä¸ªæäº¤è®°å½•ã€‚</p>
<h3 id="rebase">Rebase</h3>
<p>ç¬¬äºŒç§åˆå¹¶åˆ†æ”¯çš„æ–¹æ³•æ˜¯ <code>git rebase</code>ã€‚Rebase å®é™…ä¸Šå°±æ˜¯å–å‡ºä¸€ç³»åˆ—çš„æäº¤è®°å½•ï¼Œâ€œå¤åˆ¶â€å®ƒä»¬ï¼Œç„¶ååœ¨å¦å¤–ä¸€ä¸ªåœ°æ–¹é€ä¸ªçš„æ”¾ä¸‹å»ã€‚</p>
<p>Rebase çš„ä¼˜åŠ¿å°±æ˜¯å¯ä»¥åˆ›é€ æ›´çº¿æ€§çš„æäº¤å†å²ï¼Œè¿™å¬ä¸Šå»æœ‰äº›éš¾ä»¥ç†è§£ã€‚å¦‚æœåªå…è®¸ä½¿ç”¨ Rebase çš„è¯ï¼Œä»£ç åº“çš„æäº¤å†å²å°†ä¼šå˜å¾—å¼‚å¸¸æ¸…æ™°ã€‚</p>
<p>æˆ‘ä»¬æƒ³è¦æŠŠ bugFix åˆ†æ”¯é‡Œçš„å·¥ä½œç›´æ¥ç§»åˆ° master åˆ†æ”¯ä¸Šã€‚ç§»åŠ¨ä»¥åä¼šä½¿å¾—ä¸¤ä¸ªåˆ†æ”¯çš„åŠŸèƒ½çœ‹èµ·æ¥åƒæ˜¯æŒ‰é¡ºåºå¼€å‘ï¼Œä½†å®é™…ä¸Šå®ƒä»¬æ˜¯å¹¶è¡Œå¼€å‘çš„ã€‚</p>
<p>æ‰§è¡Œ <code>git rebase master</code> åï¼Œç°åœ¨ bugFix åˆ†æ”¯ä¸Šçš„å·¥ä½œåœ¨ master çš„æœ€é¡¶ç«¯ï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿå¾—åˆ°äº†ä¸€ä¸ªæ›´çº¿æ€§çš„æäº¤åºåˆ—ã€‚æ³¨æ„ï¼Œæäº¤è®°å½• C3 ä¾ç„¶å­˜åœ¨ï¼ˆæ ‘ä¸Šé‚£ä¸ªåŠé€æ˜çš„èŠ‚ç‚¹ï¼‰ï¼Œè€Œ C3&rsquo; æ˜¯æˆ‘ä»¬ Rebase åˆ° master åˆ†æ”¯ä¸Šçš„ C3 çš„å‰¯æœ¬ã€‚</p>
<p>æœ€ååœ¨ master åˆ†æ”¯ä¸Šæ‰§è¡Œ <code>git rebase bugFix</code>ã€‚ç”±äº <code>bugFix</code> ç»§æ‰¿è‡ª <code>master</code>ï¼Œæ‰€ä»¥ Git åªæ˜¯ç®€å•çš„æŠŠ <code>master</code> åˆ†æ”¯çš„å¼•ç”¨å‘å‰ç§»åŠ¨äº†ä¸€ä¸‹è€Œå·²ã€‚</p>
<h2 id="é«˜çº§ç¯‡">é«˜çº§ç¯‡</h2>
<p><code>git checkout</code> ç§»åŠ¨çš„æ˜¯ HEADï¼Œ<code>git branch</code> ç§»åŠ¨çš„æ˜¯åˆ†æ”¯ï¼Œéœ€è¦ -f æ‰èƒ½åŠ¨å·²æœ‰åˆ†æ”¯ï¼Œå¦åˆ™æ˜¯åˆ›å»ºåˆ†æ”¯</p>
<h3 id="åˆ†ç¦»-head">åˆ†ç¦» HEAD</h3>
<p>HEAD æ˜¯ä¸€ä¸ªå¯¹å½“å‰æ£€å‡ºè®°å½•çš„ç¬¦å·å¼•ç”¨â€”â€”ä¹Ÿå°±æ˜¯æŒ‡å‘ä½ æ­£åœ¨å…¶åŸºç¡€ä¸Šè¿›è¡Œå·¥ä½œçš„æäº¤è®°å½•ã€‚HEAD æ€»æ˜¯æŒ‡å‘å½“å‰åˆ†æ”¯ä¸Šæœ€è¿‘ä¸€æ¬¡æäº¤è®°å½•ã€‚å¤§å¤šæ•°ä¿®æ”¹æäº¤æ ‘çš„ Git å‘½ä»¤éƒ½æ˜¯ä»æ”¹å˜ HEAD çš„æŒ‡å‘å¼€å§‹çš„ã€‚HEAD é€šå¸¸æƒ…å†µä¸‹æ˜¯æŒ‡å‘åˆ†æ”¯åçš„ï¼ˆå¦‚ bugFixï¼‰ã€‚åœ¨ä½ æäº¤æ—¶ï¼Œæ”¹å˜äº† bugFix çš„çŠ¶æ€ï¼Œè¿™ä¸€å˜åŒ–é€šè¿‡ HEAD å˜å¾—å¯è§ã€‚ä¾‹å¦‚ <code>git checkout commit1</code></p>
<h3 id="ç›¸å¯¹å¼•ç”¨">ç›¸å¯¹å¼•ç”¨</h3>
<p>é€šè¿‡æŒ‡å®šæäº¤è®°å½•å“ˆå¸Œå€¼çš„æ–¹å¼åœ¨ Git ä¸­ç§»åŠ¨ä¸å¤ªæ–¹ä¾¿ã€‚åœ¨å®é™…åº”ç”¨æ—¶ï¼Œå¹¶ä¸å¾—ä¸ç”¨ <code>git log</code> æ¥æŸ¥æŸ¥çœ‹æäº¤è®°å½•çš„å“ˆå¸Œå€¼ã€‚å¹¶ä¸”å“ˆå¸Œå€¼åœ¨çœŸå®çš„ Git ä¸–ç•Œä¸­ä¹Ÿä¼šæ›´é•¿ã€‚æ¯”è¾ƒä»¤äººæ¬£æ…°çš„æ˜¯ï¼ŒGit å¯¹å“ˆå¸Œçš„å¤„ç†å¾ˆæ™ºèƒ½ã€‚ä½ åªéœ€è¦æä¾›èƒ½å¤Ÿå”¯ä¸€æ ‡è¯†æäº¤è®°å½•çš„å‰å‡ ä¸ªå­—ç¬¦å³å¯ã€‚å› æ­¤æˆ‘å¯ä»¥ä»…è¾“å…¥ <code>fed2</code> è€Œä¸æ˜¯ä¸Šé¢çš„ä¸€é•¿ä¸²å­—ç¬¦ã€‚</p>
<p>æ‰€ä»¥ Git å¼•å…¥äº†ç›¸å¯¹å¼•ç”¨ã€‚è¿™ä¸ªå°±å¾ˆå‰å®³äº†!ä½¿ç”¨ç›¸å¯¹å¼•ç”¨çš„è¯ï¼Œä½ å°±å¯ä»¥ä»ä¸€ä¸ªæ˜“äºè®°å¿†çš„åœ°æ–¹ï¼ˆæ¯”å¦‚ <code>bugFix</code> åˆ†æ”¯æˆ– <code>HEAD</code>ï¼‰å¼€å§‹è®¡ç®—ã€‚ç›¸å¯¹å¼•ç”¨éå¸¸ç»™åŠ›ï¼Œè¿™é‡Œæˆ‘ä»‹ç»ä¸¤ä¸ªç®€å•çš„ç”¨æ³•ï¼š</p>
<ul>
<li>ä½¿ç”¨ <code>^</code> å‘ä¸Šç§»åŠ¨ 1 ä¸ªæäº¤è®°å½•</li>
<li>ä½¿ç”¨ <code>~&lt;num&gt;</code> å‘ä¸Šç§»åŠ¨å¤šä¸ªæäº¤è®°å½•ï¼Œå¦‚ <code>~3</code></li>
</ul>
<p>é¦–å…ˆçœ‹çœ‹æ“ä½œç¬¦ (^)ã€‚æŠŠè¿™ä¸ªç¬¦å·åŠ åœ¨å¼•ç”¨åç§°çš„åé¢ï¼Œè¡¨ç¤ºè®© Git å¯»æ‰¾æŒ‡å®šæäº¤è®°å½•çš„çˆ¶æäº¤ã€‚æ‰€ä»¥ <code>master^</code> ç›¸å½“äºâ€œ<code>master</code> çš„çˆ¶èŠ‚ç‚¹â€ã€‚<code>master^^</code> æ˜¯ <code>master</code> çš„ç¬¬äºŒä¸ªçˆ¶èŠ‚ç‚¹</p>
<p>å¦‚æœä½ æƒ³åœ¨æäº¤æ ‘ä¸­å‘ä¸Šç§»åŠ¨å¾ˆå¤šæ­¥çš„è¯ï¼Œæ•²é‚£ä¹ˆå¤š <code>^</code> è²Œä¼¼ä¹ŸæŒºçƒ¦äººçš„ï¼ŒGit å½“ç„¶ä¹Ÿè€ƒè™‘åˆ°äº†è¿™ä¸€ç‚¹ï¼Œäºæ˜¯åˆå¼•å…¥äº†æ“ä½œç¬¦ <code>~</code>ã€‚è¯¥æ“ä½œç¬¦åé¢å¯ä»¥è·Ÿä¸€ä¸ªæ•°å­—ï¼ˆå¯é€‰ï¼Œä¸è·Ÿæ•°å­—æ—¶ä¸ <code>^</code> ç›¸åŒï¼Œå‘ä¸Šç§»åŠ¨ä¸€æ¬¡ï¼‰ï¼ŒæŒ‡å®šå‘ä¸Šç§»åŠ¨å¤šå°‘æ¬¡ã€‚</p>
<p>æˆ‘ä½¿ç”¨ç›¸å¯¹å¼•ç”¨æœ€å¤šçš„å°±æ˜¯ç§»åŠ¨åˆ†æ”¯ã€‚å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>-f</code> é€‰é¡¹è®©åˆ†æ”¯æŒ‡å‘å¦ä¸€ä¸ªæäº¤ã€‚ä¾‹å¦‚:<code>git branch -f master HEAD~3</code>ã€‚ä¸Šé¢çš„å‘½ä»¤ä¼šå°† master åˆ†æ”¯å¼ºåˆ¶æŒ‡å‘ HEAD çš„ç¬¬ 3 çº§çˆ¶æäº¤ã€‚</p>
<h3 id="æ’¤é”€å˜æ›´">æ’¤é”€å˜æ›´</h3>
<p>åœ¨ Git é‡Œæ’¤é”€å˜æ›´çš„æ–¹æ³•å¾ˆå¤šã€‚å’Œæäº¤ä¸€æ ·ï¼Œæ’¤é”€å˜æ›´ç”±åº•å±‚éƒ¨åˆ†ï¼ˆæš‚å­˜åŒºçš„ç‹¬ç«‹æ–‡ä»¶æˆ–è€…ç‰‡æ®µï¼‰å’Œä¸Šå±‚éƒ¨åˆ†ï¼ˆå˜æ›´åˆ°åº•æ˜¯é€šè¿‡å“ªç§æ–¹å¼è¢«æ’¤é”€çš„ï¼‰ç»„æˆã€‚ä¸»è¦æœ‰ä¸¤ç§æ–¹æ³•ç”¨æ¥æ’¤é”€å˜æ›´â€”â€”ä¸€æ˜¯ <code>git reset</code>ï¼Œè¿˜æœ‰å°±æ˜¯ <code>git revert</code>ã€‚</p>
<p><code>git reset</code> é€šè¿‡æŠŠåˆ†æ”¯è®°å½•å›é€€å‡ ä¸ªæäº¤è®°å½•æ¥å®ç°æ’¤é”€æ”¹åŠ¨ã€‚ä½ å¯ä»¥å°†è¿™æƒ³è±¡æˆâ€œæ”¹å†™å†å²â€ã€‚<code>git reset</code> å‘ä¸Šç§»åŠ¨åˆ†æ”¯ï¼ŒåŸæ¥æŒ‡å‘çš„æäº¤è®°å½•å°±è·Ÿä»æ¥æ²¡æœ‰æäº¤è¿‡ä¸€æ ·ã€‚<code>git reset HEAD~1</code> æŠŠ master åˆ†æ”¯ç§»å›åˆ° <code>C1</code>ï¼›ç°åœ¨æˆ‘ä»¬çš„æœ¬åœ°ä»£ç åº“æ ¹æœ¬å°±ä¸çŸ¥é“æœ‰ <code>C2</code> è¿™ä¸ªæäº¤äº†ã€‚åœ¨ reset åï¼Œ<code>C2</code> æ‰€åšçš„å˜æ›´è¿˜åœ¨ï¼Œä½†æ˜¯å¤„äºæœªåŠ å…¥æš‚å­˜åŒºçŠ¶æ€ã€‚</p>
<p>è™½ç„¶åœ¨ä½ çš„æœ¬åœ°åˆ†æ”¯ä¸­ä½¿ç”¨ <code>git reset</code> å¾ˆæ–¹ä¾¿ï¼Œä½†æ˜¯è¿™ç§â€œæ”¹å†™å†å²â€çš„æ–¹æ³•å¯¹å¤§å®¶ä¸€èµ·ä½¿ç”¨çš„è¿œç¨‹åˆ†æ”¯æ˜¯æ— æ•ˆçš„å“¦ï¼ä¸ºäº†æ’¤é”€æ›´æ”¹å¹¶ <strong>åˆ†äº«</strong> ç»™åˆ«äººï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ <code>git revert</code>ã€‚<code>git revert HEAD</code> åœ¨æˆ‘ä»¬è¦æ’¤é”€çš„æäº¤è®°å½•åé¢å±…ç„¶å¤šäº†ä¸€ä¸ªæ–°æäº¤ï¼è¿™æ˜¯å› ä¸ºæ–°æäº¤è®°å½• <code>C2'</code> å¼•å…¥äº† <strong>æ›´æ”¹</strong>â€”â€”è¿™äº›æ›´æ”¹åˆšå¥½æ˜¯ç”¨æ¥æ’¤é”€ <code>C2</code> è¿™ä¸ªæäº¤çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ <code>C2'</code> çš„çŠ¶æ€ä¸ <code>C1</code> æ˜¯ç›¸åŒçš„ã€‚revert ä¹‹åå°±å¯ä»¥æŠŠä½ çš„æ›´æ”¹æ¨é€åˆ°è¿œç¨‹ä»“åº“ä¸åˆ«äººåˆ†äº«å•¦ã€‚</p>
<h2 id="ç§»åŠ¨æäº¤è®°å½•">ç§»åŠ¨æäº¤è®°å½•</h2>
<h3 id="cherry-pick">Cherry-pick</h3>
<p><code>git cherry-pick &lt;æäº¤å·&gt;â€¦</code> å¦‚æœä½ æƒ³å°†ä¸€äº›æäº¤å¤åˆ¶åˆ°å½“å‰æ‰€åœ¨çš„ä½ç½®ï¼ˆ<code>HEAD</code>ï¼‰ä¸‹é¢çš„è¯ï¼ŒCherry-pick æ˜¯æœ€ç›´æ¥çš„æ–¹å¼äº†ã€‚æ‰§è¡Œ <code>git cherry-pick C2 C4</code> æˆ‘ä»¬åªéœ€è¦æäº¤è®°å½• <code>C2</code> å’Œ <code>C4</code>ï¼Œæ‰€ä»¥ Git å°±å°†è¢«å®ƒä»¬æŠ“è¿‡æ¥æ”¾åˆ°å½“å‰åˆ†æ”¯ä¸‹äº†ã€‚</p>
<h3 id="äº¤äº’å¼-rebase">äº¤äº’å¼ Rebase</h3>
<p>å½“ä½ çŸ¥é“ä½ æ‰€éœ€è¦çš„æäº¤è®°å½•ï¼ˆ<strong>å¹¶ä¸”</strong> è¿˜çŸ¥é“è¿™äº›æäº¤è®°å½•çš„å“ˆå¸Œå€¼ï¼‰æ—¶, ç”¨ cherry-pick å†å¥½ä¸è¿‡äº†â€”â€”æ²¡æœ‰æ¯”è¿™æ›´ç®€å•çš„æ–¹å¼äº†ã€‚ä½†æ˜¯å¦‚æœä½ ä¸æ¸…æ¥šä½ æƒ³è¦çš„æäº¤è®°å½•çš„å“ˆå¸Œå€¼å‘¢? å¹¸å¥½ Git å¸®ä½ æƒ³åˆ°äº†è¿™ä¸€ç‚¹, æˆ‘ä»¬å¯ä»¥åˆ©ç”¨äº¤äº’å¼çš„ rebaseâ€”â€”å¦‚æœä½ æƒ³ä»ä¸€ç³»åˆ—çš„æäº¤è®°å½•ä¸­æ‰¾åˆ°æƒ³è¦çš„è®°å½•, è¿™å°±æ˜¯æœ€å¥½çš„æ–¹æ³•äº†ã€‚</p>
<p>äº¤äº’å¼ rebase æŒ‡çš„æ˜¯ä½¿ç”¨å¸¦å‚æ•° <code>--interactive</code> çš„ rebase å‘½ä»¤, ç®€å†™ä¸º <code>-i</code>ã€‚å¦‚æœä½ åœ¨å‘½ä»¤åå¢åŠ äº†è¿™ä¸ªé€‰é¡¹, Git ä¼šæ‰“å¼€ä¸€ä¸ª UI ç•Œé¢å¹¶åˆ—å‡ºå°†è¦è¢«å¤åˆ¶åˆ°ç›®æ ‡åˆ†æ”¯çš„å¤‡é€‰æäº¤è®°å½•ï¼Œå®ƒè¿˜ä¼šæ˜¾ç¤ºæ¯ä¸ªæäº¤è®°å½•çš„å“ˆå¸Œå€¼å’Œæäº¤è¯´æ˜ï¼Œæäº¤è¯´æ˜æœ‰åŠ©äºä½ ç†è§£è¿™ä¸ªæäº¤è¿›è¡Œäº†å“ªäº›æ›´æ”¹ã€‚</p>
<p>å½“ rebase UI ç•Œé¢æ‰“å¼€æ—¶, ä½ èƒ½åš 3 ä»¶äº‹:</p>
<ul>
<li>è°ƒæ•´æäº¤è®°å½•çš„é¡ºåº</li>
<li>åˆ é™¤ä½ ä¸æƒ³è¦çš„æäº¤</li>
<li>åˆå¹¶æäº¤ã€‚</li>
</ul>
<h2 id="æ‚é¡¹">æ‚é¡¹</h2>
<h3 id="åªå–ä¸€ä¸ªæäº¤è®°å½•">åªå–ä¸€ä¸ªæäº¤è®°å½•</h3>
<p>æœ¬åœ°æ ˆå¼æäº¤ï¼šæ¥çœ‹ä¸€ä¸ªåœ¨å¼€å‘ä¸­ç»å¸¸ä¼šé‡åˆ°çš„æƒ…å†µï¼šæˆ‘æ­£åœ¨è§£å†³æŸä¸ªç‰¹åˆ«æ£˜æ‰‹çš„ Bugï¼Œä¸ºäº†ä¾¿äºè°ƒè¯•è€Œåœ¨ä»£ç ä¸­æ·»åŠ äº†ä¸€äº›è°ƒè¯•å‘½ä»¤å¹¶å‘æ§åˆ¶å°æ‰“å°äº†ä¸€äº›ä¿¡æ¯ã€‚è¿™äº›è°ƒè¯•å’Œæ‰“å°è¯­å¥éƒ½åœ¨å®ƒä»¬å„è‡ªçš„æäº¤è®°å½•é‡Œã€‚æœ€åæˆ‘ç»ˆäºæ‰¾åˆ°äº†é€ æˆè¿™ä¸ª Bug çš„æ ¹æœ¬åŸå› ï¼Œè§£å†³æ‰ä»¥åè§‰å¾—æ²¾æ²¾è‡ªå–œï¼æœ€åå°±å·®æŠŠ <code>bugFix</code> åˆ†æ”¯é‡Œçš„å·¥ä½œåˆå¹¶å› <code>master</code> åˆ†æ”¯äº†ã€‚ä½ å¯ä»¥é€‰æ‹©é€šè¿‡ fast-forward å¿«é€Ÿåˆå¹¶åˆ° <code>master</code> åˆ†æ”¯ä¸Šï¼Œä½†è¿™æ ·çš„è¯ <code>master</code> åˆ†æ”¯å°±ä¼šåŒ…å«æˆ‘è¿™äº›è°ƒè¯•è¯­å¥äº†ã€‚ä½ è‚¯å®šä¸æƒ³è¿™æ ·ï¼Œåº”è¯¥è¿˜æœ‰æ›´å¥½çš„æ–¹å¼â€¦â€¦</p>
<p>å®é™…æˆ‘ä»¬åªè¦è®© Git å¤åˆ¶è§£å†³é—®é¢˜çš„é‚£ä¸€ä¸ªæäº¤è®°å½•å°±å¯ä»¥äº†ã€‚è·Ÿä¹‹å‰æˆ‘ä»¬åœ¨â€œæ•´ç†æäº¤è®°å½•â€ä¸­å­¦åˆ°çš„ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>git rebase -i</code>ï¼Œ<code>git cherry-pick</code> æ¥è¾¾åˆ°ç›®çš„ã€‚</p>
<h3 id="æäº¤çš„æŠ€å·§1">æäº¤çš„æŠ€å·§#1</h3>
<p>ä½ ä¹‹å‰åœ¨ <code>newImage</code> åˆ†æ”¯ä¸Šè¿›è¡Œäº†ä¸€æ¬¡æäº¤ï¼Œç„¶ååˆåŸºäºå®ƒåˆ›å»ºäº† <code>caption</code> åˆ†æ”¯ï¼Œç„¶ååˆæäº¤äº†ä¸€æ¬¡ã€‚æ­¤æ—¶ä½ æƒ³å¯¹çš„æŸä¸ªä»¥å‰çš„æäº¤è®°å½•è¿›è¡Œä¸€äº›å°å°çš„è°ƒæ•´ã€‚æ¯”å¦‚è®¾è®¡å¸ˆæƒ³ä¿®æ”¹ä¸€ä¸‹ <code>newImage</code> ä¸­å›¾ç‰‡çš„åˆ†è¾¨ç‡ï¼Œå°½ç®¡é‚£ä¸ªæäº¤è®°å½•å¹¶ä¸æ˜¯æœ€æ–°çš„äº†ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹æ³•æ¥å…‹æœå›°éš¾ï¼š</p>
<ul>
<li>å…ˆç”¨ <code>git rebase -i</code> å°†æäº¤é‡æ–°æ’åºï¼Œç„¶åæŠŠæˆ‘ä»¬æƒ³è¦ä¿®æ”¹çš„æäº¤è®°å½•æŒªåˆ°æœ€å‰</li>
<li>ç„¶åç”¨ <code>git commit --amend</code> æ¥è¿›è¡Œä¸€äº›å°ä¿®æ”¹</li>
<li>æ¥ç€å†ç”¨ <code>git rebase -i</code> æ¥å°†ä»–ä»¬è°ƒå›åŸæ¥çš„é¡ºåº</li>
<li>æœ€åæˆ‘ä»¬æŠŠ master ç§»åˆ°ä¿®æ”¹çš„æœ€å‰ç«¯ï¼ˆç”¨ä½ è‡ªå·±å–œæ¬¢çš„æ–¹æ³•ï¼‰ï¼Œå°±å¤§åŠŸå‘Šæˆå•¦ï¼</li>
</ul>
<p>å½“ç„¶å®Œæˆè¿™ä¸ªä»»åŠ¡çš„æ–¹æ³•ä¸æ­¢ä¸Šé¢æåˆ°çš„ä¸€ç§ï¼ˆæˆ‘çŸ¥é“ä½ åœ¨çœ‹ cherry-pick å•¦ï¼‰ï¼Œä¹‹åæˆ‘ä»¬ä¼šå¤šç‚¹å…³æ³¨è¿™äº›æŠ€å·§å•¦ï¼Œä½†ç°åœ¨æš‚æ—¶åªä¸“æ³¨ä¸Šé¢è¿™ç§æ–¹æ³•ã€‚æœ€åæœ‰å¿…è¦è¯´æ˜ä¸€ä¸‹ç›®æ ‡çŠ¶æ€ä¸­çš„é‚£å‡ ä¸ª <code>'</code>â€”â€”æˆ‘ä»¬æŠŠè¿™ä¸ªæäº¤ç§»åŠ¨äº†ä¸¤æ¬¡ï¼Œæ¯ç§»åŠ¨ä¸€æ¬¡ä¼šäº§ç”Ÿä¸€ä¸ª <code>'</code>ï¼›è€Œ C2 ä¸Šå¤šå‡ºæ¥çš„é‚£ä¸ªæ˜¯æˆ‘ä»¬åœ¨ä½¿ç”¨äº† amend å‚æ•°æäº¤æ—¶äº§ç”Ÿçš„ï¼Œæ‰€ä»¥æœ€ç»ˆç»“æœå°±æ˜¯è¿™æ ·äº†ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘åœ¨å¯¹æ¯”ç»“æœçš„æ—¶å€™åªä¼šå¯¹æ¯”æäº¤æ ‘çš„ç»“æ„ï¼Œå¯¹äº <code>'</code> çš„æ•°é‡ä¸Šçš„ä¸åŒï¼Œå¹¶ä¸çº³å…¥å¯¹æ¯”èŒƒå›´å†…ã€‚åªè¦ä½ çš„ <code>master</code> åˆ†æ”¯ç»“æ„ä¸ç›®æ ‡ç»“æ„ç›¸åŒï¼Œæˆ‘å°±ç®—ä½ é€šè¿‡ã€‚</p>
<h3 id="æäº¤çš„æŠ€å·§">æäº¤çš„æŠ€å·§</h3>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>rebase -i</code> å¯¹æäº¤è®°å½•è¿›è¡Œé‡æ–°æ’åºã€‚åªè¦æŠŠæˆ‘ä»¬æƒ³è¦çš„æäº¤è®°å½•æŒªåˆ°æœ€å‰ç«¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾ˆè½»æ¾çš„ç”¨ <code>--amend</code> ä¿®æ”¹å®ƒï¼Œç„¶åæŠŠå®ƒä»¬é‡æ–°æ’æˆæˆ‘ä»¬æƒ³è¦çš„é¡ºåºã€‚ä½†è¿™æ ·åšå°±å”¯ä¸€çš„é—®é¢˜å°±æ˜¯è¦è¿›è¡Œä¸¤æ¬¡æ’åºï¼Œè€Œè¿™æœ‰å¯èƒ½é€ æˆç”± rebase è€Œå¯¼è‡´çš„å†²çªã€‚ä¸‹é¢è¿˜æ˜¯çœ‹çœ‹ <code>git cherry-pick</code> æ˜¯æ€ä¹ˆåšçš„å§ã€‚</p>
<p>è¦åœ¨å¿ƒé‡Œç‰¢è®° cherry-pick å¯ä»¥å°†æäº¤æ ‘ä¸Šä»»ä½•åœ°æ–¹çš„æäº¤è®°å½•å–è¿‡æ¥è¿½åŠ åˆ° HEAD ä¸Šï¼ˆåªè¦ä¸æ˜¯ HEAD ä¸Šæ¸¸çš„æäº¤å°±æ²¡é—®é¢˜ï¼‰ã€‚</p>
<ul>
<li><code>git rebase -i</code></li>
<li><code>git commit --amend</code></li>
<li><code>git cherry-pick</code></li>
</ul>
<h3 id="git-tag">Git Tag</h3>
<p>åˆ†æ”¯å¾ˆå®¹æ˜“è¢«äººä¸ºç§»åŠ¨ï¼Œå¹¶ä¸”å½“æœ‰æ–°çš„æäº¤æ—¶ï¼Œå®ƒä¹Ÿä¼šç§»åŠ¨ã€‚åˆ†æ”¯å¾ˆå®¹æ˜“è¢«æ”¹å˜ï¼Œå¤§éƒ¨åˆ†åˆ†æ”¯è¿˜åªæ˜¯ä¸´æ—¶çš„ï¼Œå¹¶ä¸”è¿˜ä¸€ç›´åœ¨å˜ã€‚ä½ å¯èƒ½ä¼šé—®äº†ï¼šæœ‰æ²¡æœ‰ä»€ä¹ˆå¯ä»¥ <em>æ°¸è¿œ</em> æŒ‡å‘æŸä¸ªæäº¤è®°å½•çš„æ ‡è¯†å‘¢ï¼Œæ¯”å¦‚è½¯ä»¶å‘å¸ƒæ–°çš„å¤§ç‰ˆæœ¬ï¼Œæˆ–è€…æ˜¯ä¿®æ­£ä¸€äº›é‡è¦çš„ Bug æˆ–æ˜¯å¢åŠ äº†æŸäº›æ–°ç‰¹æ€§ï¼Œæœ‰æ²¡æœ‰æ¯”åˆ†æ”¯æ›´å¥½çš„å¯ä»¥æ°¸è¿œæŒ‡å‘è¿™äº›æäº¤çš„æ–¹æ³•å‘¢ï¼Ÿ</p>
<p>å½“ç„¶æœ‰äº†ï¼Git çš„ tag å°±æ˜¯å¹²è¿™ä¸ªç”¨çš„å•Šï¼Œå®ƒä»¬å¯ä»¥ï¼ˆåœ¨æŸç§ç¨‹åº¦ä¸Šâ€”â€”å› ä¸ºæ ‡ç­¾å¯ä»¥è¢«åˆ é™¤åé‡æ–°åœ¨å¦å¤–ä¸€ä¸ªä½ç½®åˆ›å»ºåŒåçš„æ ‡ç­¾ï¼‰æ°¸ä¹…åœ°å°†æŸä¸ªç‰¹å®šçš„æäº¤å‘½åä¸ºé‡Œç¨‹ç¢‘ï¼Œç„¶åå°±å¯ä»¥åƒåˆ†æ”¯ä¸€æ ·å¼•ç”¨äº†ã€‚æ›´éš¾å¾—çš„æ˜¯ï¼Œå®ƒä»¬å¹¶ä¸ä¼šéšç€æ–°çš„æäº¤è€Œç§»åŠ¨ã€‚ä½ ä¹Ÿä¸èƒ½æ£€å‡ºåˆ°æŸä¸ªæ ‡ç­¾ä¸Šé¢è¿›è¡Œä¿®æ”¹æäº¤ï¼Œå®ƒå°±åƒæ˜¯æäº¤æ ‘ä¸Šçš„ä¸€ä¸ªé”šç‚¹ï¼Œæ ‡è¯†äº†æŸä¸ªç‰¹å®šçš„ä½ç½®ã€‚</p>
<p><code>git tag v1 C1</code> å°†è¿™ä¸ªæ ‡ç­¾å‘½åä¸º <code>v1</code>ï¼Œå¹¶ä¸”æ˜ç¡®åœ°è®©å®ƒæŒ‡å‘æäº¤è®°å½• <code>C1</code>ï¼Œå¦‚æœä½ ä¸æŒ‡å®šæäº¤è®°å½•ï¼ŒGit ä¼šç”¨ <code>HEAD</code> æ‰€æŒ‡å‘çš„ä½ç½®ã€‚</p>
<p>å¯ä»¥ç›´æ¥ checkout åˆ° commit ä¸Šæˆ–æ˜¯ç®€å•çš„ checkout åˆ° tag ä¸Šã€‚</p>
<h3 id="git-describe">Git Describe</h3>
<p>ç”±äºæ ‡ç­¾åœ¨ä»£ç åº“ä¸­èµ·ç€â€œé”šç‚¹â€çš„ä½œç”¨ï¼ŒGit è¿˜ä¸ºæ­¤ä¸“é—¨è®¾è®¡äº†ä¸€ä¸ªå‘½ä»¤ç”¨æ¥ <strong>æè¿°</strong> ç¦»ä½ æœ€è¿‘çš„é”šç‚¹ï¼ˆä¹Ÿå°±æ˜¯æ ‡ç­¾ï¼‰ï¼Œå®ƒå°±æ˜¯ <code>git describe</code>ï¼Git Describe èƒ½å¸®ä½ åœ¨æäº¤å†å²ä¸­ç§»åŠ¨äº†å¤šæ¬¡ä»¥åæ‰¾åˆ°æ–¹å‘ï¼›å½“ä½ ç”¨ <code>git bisect</code>ï¼ˆä¸€ä¸ªæŸ¥æ‰¾äº§ç”Ÿ Bug çš„æäº¤è®°å½•çš„æŒ‡ä»¤ï¼‰æ‰¾åˆ°æŸä¸ªæäº¤è®°å½•æ—¶ï¼Œæˆ–è€…æ˜¯å½“ä½ ååœ¨ä½ é‚£åˆšåˆšåº¦å‡å›æ¥çš„åŒäº‹çš„ç”µè„‘å‰æ—¶ï¼Œå¯èƒ½ä¼šç”¨åˆ°è¿™ä¸ªå‘½ä»¤ã€‚</p>
<p><code>git describe</code> çš„è¯­æ³•æ˜¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">git describe &lt;ref&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>&lt;ref&gt;</code> å¯ä»¥æ˜¯ä»»ä½•èƒ½è¢« Git è¯†åˆ«æˆæäº¤è®°å½•çš„å¼•ç”¨ï¼Œå¦‚æœä½ æ²¡æœ‰æŒ‡å®šçš„è¯ï¼ŒGit ä¼šä»¥ä½ ç›®å‰æ‰€æ£€å‡ºçš„ä½ç½®ï¼ˆ<code>HEAD</code>ï¼‰ã€‚</p>
<p>å®ƒè¾“å‡ºçš„ç»“æœæ˜¯è¿™æ ·çš„ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">&lt;tag&gt;_&lt;numCommits&gt;_g&lt;hash&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>tag</code> è¡¨ç¤ºçš„æ˜¯ç¦» <code>ref</code> æœ€è¿‘çš„æ ‡ç­¾ï¼Œ<code>numCommits</code> æ˜¯è¡¨ç¤ºè¿™ä¸ª <code>ref</code> ä¸ <code>tag</code> ç›¸å·®æœ‰å¤šå°‘ä¸ªæäº¤è®°å½•ï¼Œ<code>hash</code> è¡¨ç¤ºçš„æ˜¯ä½ æ‰€ç»™å®šçš„ <code>ref</code> æ‰€è¡¨ç¤ºçš„æäº¤è®°å½•å“ˆå¸Œå€¼çš„å‰å‡ ä½ã€‚</p>
<p>å½“ <code>ref</code> æäº¤è®°å½•ä¸Šæœ‰æŸä¸ªæ ‡ç­¾æ—¶ï¼Œåˆ™åªè¾“å‡ºæ ‡ç­¾åç§°</p>
<h3 id="ä¸¤ä¸ªçˆ¶èŠ‚ç‚¹">ä¸¤ä¸ªçˆ¶èŠ‚ç‚¹</h3>
<p>æ“ä½œç¬¦ <code>^</code> ä¸ <code>~</code> ç¬¦ä¸€æ ·ï¼Œåé¢ä¹Ÿå¯ä»¥è·Ÿä¸€ä¸ªæ•°å­—ã€‚ä½†æ˜¯è¯¥æ“ä½œç¬¦åé¢çš„æ•°å­—ä¸ <code>~</code> åé¢çš„ä¸åŒï¼Œå¹¶ä¸æ˜¯ç”¨æ¥æŒ‡å®šå‘ä¸Šè¿”å›å‡ ä»£ï¼Œè€Œæ˜¯æŒ‡å®šåˆå¹¶æäº¤è®°å½•çš„æŸä¸ªçˆ¶æäº¤ã€‚è¿˜è®°å¾—å‰é¢æåˆ°è¿‡çš„ä¸€ä¸ªåˆå¹¶æäº¤æœ‰ä¸¤ä¸ªçˆ¶æäº¤å§ï¼Œæ‰€ä»¥é‡åˆ°è¿™æ ·çš„èŠ‚ç‚¹æ—¶è¯¥é€‰æ‹©å“ªæ¡è·¯å¾„å°±ä¸æ˜¯å¾ˆæ¸…æ™°äº†ã€‚Git é»˜è®¤é€‰æ‹©åˆå¹¶æäº¤çš„â€œç¬¬ä¸€ä¸ªâ€çˆ¶æäº¤ï¼Œåœ¨æ“ä½œç¬¦ <code>^</code> åè·Ÿä¸€ä¸ªæ•°å­—å¯ä»¥æ”¹å˜è¿™ä¸€é»˜è®¤è¡Œä¸ºã€‚</p>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªåˆå¹¶æäº¤è®°å½•ã€‚<code>git checkout master^</code>ï¼Œå¦‚æœä¸åŠ æ•°å­—ä¿®æ”¹ç¬¦ç›´æ¥æ£€å‡º <code>master^</code>ï¼Œä¼šå›åˆ°ç¬¬ä¸€ä¸ªçˆ¶æäº¤è®°å½•ã€‚<code>git checkout master^2</code> ä¼šè·‘åˆ°å¦ä¸€ä¸ªçˆ¶æäº¤ä¸Šã€‚</p>
<p>ä½¿ç”¨ <code>^</code> å’Œ <code>~</code> èƒ½è‡ªç”±çš„åœ¨æäº¤æ ‘ä¸­ç§»åŠ¨ï¼Œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">git checkout HEAD~<span class="p">;</span> git checkout HEAD^2<span class="p">;</span> git checkout HEAD~2
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ“ä½œç¬¦æ”¯æŒé“¾å¼æ“ä½œï¼Œä¸Šé¢çš„å‘½ä»¤ç­‰ä»·äº <code>git checkout HEAD~^2~2</code></p>
<h2 id="è¿œç¨‹ä»“åº“">è¿œç¨‹ä»“åº“</h2>
<p>è¿œç¨‹ä»“åº“å¹¶ä¸å¤æ‚, åœ¨å¦‚ä»Šçš„äº‘è®¡ç®—ç››è¡Œçš„ä¸–ç•Œå¾ˆå®¹æ˜“æŠŠè¿œç¨‹ä»“åº“æƒ³è±¡æˆä¸€ä¸ªå¯Œæœ‰é­”åŠ›çš„ä¸œè¥¿, ä½†å®é™…ä¸Šå®ƒä»¬åªæ˜¯ä½ çš„ä»“åº“åœ¨å¦ä¸ªä¸€å°è®¡ç®—æœºä¸Šçš„æ‹·è´ã€‚ä½ å¯ä»¥é€šè¿‡å› ç‰¹ç½‘ä¸è¿™å°è®¡ç®—æœºé€šä¿¡â€”â€”ä¹Ÿå°±æ˜¯å¢åŠ æˆ–æ˜¯è·å–æäº¤è®°å½•</p>
<p>è¯è™½å¦‚æ­¤, è¿œç¨‹ä»“åº“å´æœ‰ä¸€ç³»åˆ—å¼ºå¤§çš„ç‰¹æ€§</p>
<ul>
<li>é¦–å…ˆä¹Ÿæ˜¯æœ€é‡è¦çš„çš„ç‚¹, è¿œç¨‹ä»“åº“æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å¤‡ä»½ã€‚æœ¬åœ°ä»“åº“ä¹Ÿæœ‰æ¢å¤æ–‡ä»¶åˆ°æŒ‡å®šç‰ˆæœ¬çš„èƒ½åŠ›, ä½†æ‰€æœ‰çš„ä¿¡æ¯éƒ½æ˜¯ä¿å­˜åœ¨æœ¬åœ°çš„ã€‚æœ‰äº†è¿œç¨‹ä»“åº“ä»¥åï¼Œå³ä½¿ä¸¢å¤±äº†æœ¬åœ°æ‰€æœ‰æ•°æ®, ä½ ä»å¯ä»¥é€šè¿‡è¿œç¨‹ä»“åº“æ‹¿å›ä½ ä¸¢å¤±çš„æ•°æ®ã€‚</li>
<li>è¿˜æœ‰å°±æ˜¯, è¿œç¨‹è®©ä»£ç ç¤¾äº¤åŒ–äº†! æ—¢ç„¶ä½ çš„é¡¹ç›®è¢«æ‰˜ç®¡åˆ°åˆ«çš„åœ°æ–¹äº†, ä½ çš„æœ‹å‹å¯ä»¥æ›´å®¹æ˜“åœ°ä¸ºä½ çš„é¡¹ç›®åšè´¡çŒ® (æˆ–è€…æ‹‰å–æœ€æ–°çš„å˜æ›´)</li>
</ul>
<p>ç°åœ¨ç”¨ç½‘ç«™æ¥å¯¹è¿œç¨‹ä»“åº“è¿›è¡Œå¯è§†åŒ–æ“ä½œå˜å¾—è¶Šå‘æµè¡Œäº† (åƒ <a href="https://github.com/" target="_blank" rel="noopener noreffer ">GitHub</a> æˆ– <a href="http://phabricator.org/" target="_blank" rel="noopener noreffer ">Phabricator</a>), ä½†è¿œç¨‹ä»“åº“ <strong>æ°¸è¿œ</strong> æ˜¯è¿™äº›å·¥å…·çš„é¡¶æ¢æŸ±, å› æ­¤ç†è§£å…¶æ¦‚å¿µéå¸¸çš„é‡è¦!</p>
<h3 id="clone">Clone</h3>
<p>ä»æŠ€æœ¯ä¸Šæ¥è®²ï¼Œ<code>git clone</code> å‘½ä»¤åœ¨çœŸå®çš„ç¯å¢ƒä¸‹çš„ä½œç”¨æ˜¯åœ¨ <strong>æœ¬åœ°</strong> åˆ›å»ºä¸€ä¸ªè¿œç¨‹ä»“åº“çš„æ‹·è´ï¼ˆæ¯”å¦‚ä» github.comï¼‰ã€‚</p>
<h3 id="è¿œç¨‹åˆ†æ”¯">è¿œç¨‹åˆ†æ”¯</h3>
<p>æˆ‘ä»¬çš„æœ¬åœ°ä»“åº“å¤šäº†ä¸€ä¸ªåä¸º <code>o/master</code> çš„åˆ†æ”¯, è¿™ç§ç±»å‹çš„åˆ†æ”¯å°±å« <strong>è¿œç¨‹</strong> åˆ†æ”¯ã€‚ç”±äºè¿œç¨‹åˆ†æ”¯çš„ç‰¹æ€§å¯¼è‡´å…¶æ‹¥æœ‰ä¸€äº›ç‰¹æ®Šå±æ€§ã€‚</p>
<p>è¿œç¨‹åˆ†æ”¯åæ˜ äº†è¿œç¨‹ä»“åº“ (åœ¨ä½ ä¸Šæ¬¡å’Œå®ƒé€šä¿¡æ—¶) çš„ <strong>çŠ¶æ€</strong>ã€‚è¿™ä¼šæœ‰åŠ©äºä½ ç†è§£æœ¬åœ°çš„å·¥ä½œä¸å…¬å…±å·¥ä½œçš„å·®åˆ«â€”â€”è¿™æ˜¯ä½ ä¸åˆ«äººåˆ†äº«å·¥ä½œæˆæœå‰è‡³å…³é‡è¦çš„ä¸€æ­¥.</p>
<p>è¿œç¨‹åˆ†æ”¯æœ‰ä¸€ä¸ªç‰¹åˆ«çš„å±æ€§ï¼Œåœ¨ä½ æ£€å‡ºæ—¶è‡ªåŠ¨è¿›å…¥åˆ†ç¦» HEAD çŠ¶æ€ã€‚Git è¿™ä¹ˆåšæ˜¯å‡ºäºä¸èƒ½ç›´æ¥åœ¨è¿™äº›åˆ†æ”¯ä¸Šè¿›è¡Œæ“ä½œçš„åŸå› , ä½ å¿…é¡»åœ¨åˆ«çš„åœ°æ–¹å®Œæˆä½ çš„å·¥ä½œ,ï¼ˆæ›´æ–°äº†è¿œç¨‹åˆ†æ”¯ä¹‹åï¼‰å†ç”¨è¿œç¨‹åˆ†äº«ä½ çš„å·¥ä½œæˆæœã€‚</p>
<p>ä½ å¯èƒ½æƒ³é—®è¿™äº›è¿œç¨‹åˆ†æ”¯çš„å‰é¢çš„ <code>o/</code> æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå¥½å§, è¿œç¨‹åˆ†æ”¯æœ‰ä¸€ä¸ªå‘½åè§„èŒƒâ€”â€”å®ƒä»¬çš„æ ¼å¼æ˜¯:</p>
<ul>
<li><code>&lt;remote name&gt;/&lt;branch name&gt;</code></li>
</ul>
<p>å› æ­¤ï¼Œå¦‚æœä½ çœ‹åˆ°ä¸€ä¸ªåä¸º <code>o/master</code> çš„åˆ†æ”¯ï¼Œé‚£ä¹ˆè¿™ä¸ªåˆ†æ”¯å°±å« <code>master</code>ï¼Œè¿œç¨‹ä»“åº“çš„åç§°å°±æ˜¯ <code>o</code>ã€‚</p>
<p>å¤§å¤šæ•°çš„å¼€å‘äººå‘˜ä¼šå°†å®ƒä»¬ä¸»è¦çš„è¿œç¨‹ä»“åº“å‘½åä¸º <code>origin</code>ï¼Œå¹¶ä¸æ˜¯ <code>o</code>ã€‚è¿™æ˜¯å› ä¸ºå½“ä½ ç”¨ <code>git clone</code> æŸä¸ªä»“åº“æ—¶ï¼ŒGit å·²ç»å¸®ä½ æŠŠè¿œç¨‹ä»“åº“çš„åç§°è®¾ç½®ä¸º <code>origin</code> äº†</p>
<p>å½“æ‰§è¡Œ <code>git checkout origin/master; git commit</code>ï¼ŒGit å˜æˆäº†åˆ†ç¦» HEAD çŠ¶æ€ï¼Œå½“æ·»åŠ æ–°çš„æäº¤æ—¶ <code>o/master</code> ä¹Ÿä¸ä¼šæ›´æ–°ã€‚è¿™æ˜¯å› ä¸º <code>o/master</code> åªæœ‰åœ¨è¿œç¨‹ä»“åº“ä¸­ç›¸åº”çš„åˆ†æ”¯æ›´æ–°äº†ä»¥åæ‰ä¼šæ›´æ–°ã€‚</p>
<h3 id="fetch">Fetch</h3>
<p>Git è¿œç¨‹ä»“åº“ç›¸å½“çš„æ“ä½œå®é™…å¯ä»¥å½’çº³ä¸ºä¸¤ç‚¹ï¼šå‘è¿œç¨‹ä»“åº“ä¼ è¾“æ•°æ®ä»¥åŠä»è¿œç¨‹ä»“åº“è·å–æ•°æ®ã€‚æ—¢ç„¶æˆ‘ä»¬èƒ½ä¸è¿œç¨‹ä»“åº“åŒæ­¥ï¼Œé‚£ä¹ˆå°±å¯ä»¥åˆ†äº«ä»»ä½•èƒ½è¢« Git ç®¡ç†çš„æ›´æ–°ï¼ˆå› æ­¤å¯ä»¥åˆ†äº«ä»£ç ã€æ–‡ä»¶ã€æƒ³æ³•ã€æƒ…ä¹¦ç­‰ç­‰ï¼‰ã€‚ä»è¿œç¨‹ä»“åº“è·å–æ•°æ®â€”â€”å‘½ä»¤å¦‚å…¶åï¼Œå®ƒå°±æ˜¯ <code>git fetch</code>ã€‚ä½ ä¼šçœ‹åˆ°å½“æˆ‘ä»¬ä»è¿œç¨‹ä»“åº“è·å–æ•°æ®æ—¶, è¿œç¨‹åˆ†æ”¯ä¹Ÿä¼šæ›´æ–°ä»¥åæ˜ æœ€æ–°çš„è¿œç¨‹ä»“åº“ã€‚</p>
<h4 id="fetch-åšäº†ä»€ä¹ˆ">Fetch åšäº†ä»€ä¹ˆ</h4>
<p><code>git fetch</code> å®Œæˆäº†ä»…æœ‰çš„ä½†æ˜¯å¾ˆé‡è¦çš„ä¸¤æ­¥:</p>
<ul>
<li>ä»è¿œç¨‹ä»“åº“ä¸‹è½½æœ¬åœ°ä»“åº“ä¸­ç¼ºå¤±çš„æäº¤è®°å½•</li>
<li>æ›´æ–°è¿œç¨‹åˆ†æ”¯æŒ‡é’ˆ (å¦‚ <code>o/master</code>)</li>
</ul>
<p><code>git fetch</code> å®é™…ä¸Šå°†æœ¬åœ°ä»“åº“ä¸­çš„è¿œç¨‹åˆ†æ”¯æ›´æ–°æˆäº†è¿œç¨‹ä»“åº“ç›¸åº”åˆ†æ”¯æœ€æ–°çš„çŠ¶æ€ã€‚</p>
<p>å¦‚æœä½ è¿˜è®°å¾—ä¸Šä¸€èŠ‚è¯¾ç¨‹ä¸­æˆ‘ä»¬è¯´è¿‡çš„ï¼Œè¿œç¨‹åˆ†æ”¯åæ˜ äº†è¿œç¨‹ä»“åº“åœ¨ä½  <strong>æœ€åä¸€æ¬¡ä¸å®ƒé€šä¿¡æ—¶</strong> çš„çŠ¶æ€ï¼Œ<code>git fetch</code> å°±æ˜¯ä½ ä¸è¿œç¨‹ä»“åº“é€šä¿¡çš„æ–¹å¼äº†ï¼å¸Œæœ›æˆ‘è¯´çš„å¤Ÿæ˜ç™½äº†ï¼Œä½ å·²ç»äº†è§£ <code>git fetch</code> ä¸è¿œç¨‹åˆ†æ”¯ä¹‹é—´çš„å…³ç³»äº†å§ã€‚</p>
<p><code>git fetch</code> é€šå¸¸é€šè¿‡äº’è”ç½‘ï¼ˆä½¿ç”¨ <code>http://</code> æˆ– <code>git://</code> åè®®) ä¸è¿œç¨‹ä»“åº“é€šä¿¡ã€‚</p>
<h4 id="fetch-ä¸åšä»€ä¹ˆ">Fetch ä¸åšä»€ä¹ˆ</h4>
<p><code>git fetch</code> å¹¶ä¸ä¼šæ”¹å˜ä½ æœ¬åœ°ä»“åº“çš„çŠ¶æ€ã€‚å®ƒä¸ä¼šæ›´æ–°ä½ çš„ <code>master</code> åˆ†æ”¯ï¼Œä¹Ÿä¸ä¼šä¿®æ”¹ä½ ç£ç›˜ä¸Šçš„æ–‡ä»¶ã€‚</p>
<p>ç†è§£è¿™ä¸€ç‚¹å¾ˆé‡è¦ï¼Œå› ä¸ºè®¸å¤šå¼€å‘äººå‘˜è¯¯ä»¥ä¸ºæ‰§è¡Œäº† <code>git fetch</code> ä»¥åï¼Œä»–ä»¬æœ¬åœ°ä»“åº“å°±ä¸è¿œç¨‹ä»“åº“åŒæ­¥äº†ã€‚å®ƒå¯èƒ½å·²ç»å°†è¿›è¡Œè¿™ä¸€æ“ä½œæ‰€éœ€çš„æ‰€æœ‰æ•°æ®éƒ½ä¸‹è½½äº†ä¸‹æ¥ï¼Œä½†æ˜¯ <strong>å¹¶æ²¡æœ‰</strong> ä¿®æ”¹ä½ æœ¬åœ°çš„æ–‡ä»¶ã€‚æˆ‘ä»¬åœ¨åé¢çš„è¯¾ç¨‹ä¸­å°†ä¼šè®²è§£èƒ½å®Œæˆè¯¥æ“ä½œçš„å‘½ä»¤ :D</p>
<p>æ‰€ä»¥, ä½ å¯ä»¥å°† <code>git fetch</code> çš„ç†è§£ä¸ºå•çº¯çš„ä¸‹è½½æ“ä½œã€‚</p>
<h3 id="pull">Pull</h3>
<p>æ—¢ç„¶æˆ‘ä»¬å·²ç»çŸ¥é“äº†å¦‚ä½•ç”¨ <code>git fetch</code> è·å–è¿œç¨‹çš„æ•°æ®, ç°åœ¨æˆ‘ä»¬å­¦ä¹ å¦‚ä½•å°†è¿™äº›å˜åŒ–æ›´æ–°åˆ°æˆ‘ä»¬çš„å·¥ä½œå½“ä¸­ã€‚å…¶å®æœ‰å¾ˆå¤šæ–¹æ³•çš„â€”â€”å½“è¿œç¨‹åˆ†æ”¯ä¸­æœ‰æ–°çš„æäº¤æ—¶ï¼Œä½ å¯ä»¥åƒåˆå¹¶æœ¬åœ°åˆ†æ”¯é‚£æ ·æ¥åˆå¹¶è¿œç¨‹åˆ†æ”¯ã€‚ä¹Ÿå°±æ˜¯è¯´å°±æ˜¯ä½ å¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤:</p>
<ul>
<li><code>git cherry-pick o/master</code></li>
<li><code>git rebase o/master</code></li>
<li><code>git merge o/master</code></li>
<li>ç­‰ç­‰</li>
</ul>
<p>å®é™…ä¸Šï¼Œç”±äºå…ˆæŠ“å–æ›´æ–°å†åˆå¹¶åˆ°æœ¬åœ°åˆ†æ”¯è¿™ä¸ªæµç¨‹å¾ˆå¸¸ç”¨ï¼Œå› æ­¤ Git æä¾›äº†ä¸€ä¸ªä¸“é—¨çš„å‘½ä»¤æ¥å®Œæˆè¿™ä¸¤ä¸ªæ“ä½œã€‚å®ƒå°±æ˜¯æˆ‘ä»¬è¦è®²çš„ <code>git pull</code>ã€‚</p>
<p>æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ <code>fetch</code>ã€<code>merge</code> ä¾æ¬¡æ‰§è¡Œçš„æ•ˆæœ <code>git fetch; git merge o/master</code>â€”â€”æˆ‘ä»¬ç”¨ <code>fetch</code> ä¸‹è½½äº† <code>C3</code>, ç„¶åé€šè¿‡ <code>git merge o/master</code> åˆå¹¶äº†è¿™ä¸€æäº¤è®°å½•ã€‚ç°åœ¨æˆ‘ä»¬çš„ <code>master</code> åˆ†æ”¯åŒ…å«äº†è¿œç¨‹ä»“åº“ä¸­çš„æ›´æ–°ï¼ˆåœ¨æœ¬ä¾‹ä¸­è¿œç¨‹ä»“åº“åä¸º <code>origin</code>ï¼‰ã€‚<code>git pull</code> å°±æ˜¯ git fetch å’Œ git merge çš„ç¼©å†™ï¼</p>
<h3 id="push">Push</h3>
<p>ä¸Šä¼ è‡ªå·±åˆ†äº«å†…å®¹ä¸ä¸‹è½½ä»–äººçš„åˆ†äº«åˆšå¥½ç›¸åï¼Œé‚£ä¸ <code>git pull</code> ç›¸åçš„å‘½ä»¤æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ<code>git push</code>ï¼<code>git push</code> è´Ÿè´£å°† <strong>ä½ çš„</strong> å˜æ›´ä¸Šä¼ åˆ°æŒ‡å®šçš„è¿œç¨‹ä»“åº“ï¼Œå¹¶åœ¨è¿œç¨‹ä»“åº“ä¸Šåˆå¹¶ä½ çš„æ–°æäº¤è®°å½•ã€‚ä¸€æ—¦ <code>git push</code> å®Œæˆ, ä½ çš„æœ‹å‹ä»¬å°±å¯ä»¥ä»è¿™ä¸ªè¿œç¨‹ä»“åº“ä¸‹è½½ä½ åˆ†äº«çš„æˆæœäº†ï¼ä½ å¯ä»¥å°† <code>git push</code> æƒ³è±¡æˆå‘å¸ƒä½ æˆæœçš„å‘½ä»¤ã€‚</p>
<ul>
<li>æ³¨æ„â€”â€”<code>git push</code> ä¸å¸¦ä»»ä½•å‚æ•°æ—¶çš„è¡Œä¸ºä¸ Git çš„ä¸€ä¸ªåä¸º <code>push.default</code> çš„é…ç½®æœ‰å…³ã€‚å®ƒçš„é»˜è®¤å€¼å–å†³äºä½ æ­£ä½¿ç”¨çš„ Git çš„ç‰ˆæœ¬ã€‚</li>
</ul>
<p><code>git push</code> ä¹‹åï¼Œè¿œç¨‹ä»“åº“æ¥æ”¶äº† <code>C2</code>ï¼Œè¿œç¨‹ä»“åº“ä¸­çš„ <code>master</code> åˆ†æ”¯ä¹Ÿè¢«æ›´æ–°åˆ°æŒ‡å‘ <code>C2</code> äº†ï¼Œæˆ‘ä»¬çš„è¿œç¨‹åˆ†æ”¯ (o/master) ä¹ŸåŒæ ·è¢«æ›´æ–°äº†ã€‚æ‰€æœ‰çš„åˆ†æ”¯éƒ½åŒæ­¥äº†ï¼</p>
<h3 id="æœ‰å†²çªçš„-push">æœ‰å†²çªçš„ Push</h3>
<p>åœ¨ push å‰ rebase</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">git fetch
</span></span><span class="line"><span class="cl">git rebase origin/master
</span></span><span class="line"><span class="cl">git push
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬ç”¨ <code>git fetch</code> æ›´æ–°äº†æœ¬åœ°ä»“åº“ä¸­çš„è¿œç¨‹åˆ†æ”¯ï¼Œç„¶åç”¨ rebase å°†æˆ‘ä»¬çš„å·¥ä½œç§»åŠ¨åˆ°æœ€æ–°çš„æäº¤è®°å½•ä¸‹ï¼Œæœ€åå†ç”¨ <code>git push</code> æ¨é€åˆ°è¿œç¨‹ä»“åº“ã€‚</p>
<p>è¿˜å¯ä»¥ç”¨ <code>git merge</code>ã€‚å°½ç®¡ <code>git merge</code> ä¸ä¼šç§»åŠ¨ä½ çš„å·¥ä½œï¼ˆå®ƒä¼šåˆ›å»ºæ–°çš„åˆå¹¶æäº¤ï¼‰ï¼Œä½†æ˜¯å®ƒä¼šå‘Šè¯‰ Git ä½ å·²ç»åˆå¹¶äº†è¿œç¨‹ä»“åº“çš„æ‰€æœ‰å˜æ›´ã€‚è¿™æ˜¯å› ä¸ºè¿œç¨‹åˆ†æ”¯ç°åœ¨æ˜¯ä½ æœ¬åœ°åˆ†æ”¯çš„ç¥–å…ˆï¼Œä¹Ÿå°±æ˜¯è¯´ä½ çš„æäº¤å·²ç»åŒ…å«äº†è¿œç¨‹åˆ†æ”¯çš„æ‰€æœ‰å˜åŒ–ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">git fetch
</span></span><span class="line"><span class="cl">git merge origin/master
</span></span><span class="line"><span class="cl">git push
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ‘ä»¬ç”¨ <code>git fetch</code> æ›´æ–°äº†æœ¬åœ°ä»“åº“ä¸­çš„è¿œç¨‹åˆ†æ”¯ï¼Œç„¶å <strong>åˆå¹¶</strong> äº†æ–°å˜æ›´åˆ°æˆ‘ä»¬çš„æœ¬åœ°åˆ†æ”¯ï¼ˆä¸ºäº†åŒ…å«è¿œç¨‹ä»“åº“çš„å˜æ›´ï¼‰ï¼Œæœ€åæˆ‘ä»¬ç”¨ <code>git push</code> æŠŠå·¥ä½œæ¨é€åˆ°è¿œç¨‹ä»“åº“ã€‚</p>
<p>ä¸ºäº†ç®€ä¾¿å‘½ä»¤ï¼Œ<code>git pull</code> æ˜¯ <code>fetch</code> å’Œ <code>merge</code> çš„ç®€å†™ï¼Œ<code>git pull --rebase</code> æ˜¯ <code>fetch</code> å’Œ <code>rebase</code> çš„ç®€å†™ã€‚</p>
<h3 id="é”å®šçš„-master">é”å®šçš„ Master</h3>
<p>å¦‚æœä½ æ˜¯åœ¨ä¸€ä¸ªå¤§çš„åˆä½œå›¢é˜Ÿä¸­å·¥ä½œ, å¾ˆå¯èƒ½æ˜¯ master è¢«é”å®šäº†, éœ€è¦ä¸€äº› Pull Request æµç¨‹æ¥åˆå¹¶ä¿®æ”¹ã€‚å¦‚æœä½ ç›´æ¥æäº¤ (commit) åˆ°æœ¬åœ° master, ç„¶åè¯•å›¾æ¨é€ (push) ä¿®æ”¹, ä½ å°†ä¼šæ”¶åˆ°è¿™æ ·ç±»ä¼¼çš„ä¿¡æ¯:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"> ! [è¿œç¨‹æœåŠ¡å™¨æ‹’ç»] master -&gt; master (TF402455: ä¸å…è®¸æ¨é€(push)è¿™ä¸ªåˆ†æ”¯; ä½ å¿…é¡»ä½¿ç”¨pull requestæ¥æ›´æ–°è¿™ä¸ªåˆ†æ”¯.)
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿œç¨‹æœåŠ¡å™¨æ‹’ç»ç›´æ¥æ¨é€ (push) æäº¤åˆ° master, å› ä¸ºç­–ç•¥é…ç½®è¦æ±‚ pull requests æ¥æäº¤æ›´æ–°ã€‚ä½ åº”è¯¥æŒ‰ç…§æµç¨‹,æ–°å»ºä¸€ä¸ªåˆ†æ”¯, æ¨é€ (push) è¿™ä¸ªåˆ†æ”¯å¹¶ç”³è¯· pull request,ä½†æ˜¯ä½ å¿˜è®°å¹¶ç›´æ¥æäº¤ç»™äº† master.ç°åœ¨ä½ å¡ä½å¹¶ä¸”æ— æ³•æ¨é€ä½ çš„æ›´æ–°.</p>
<p>è§£å†³æ–¹æ³•æ˜¯æ–°å»ºä¸€ä¸ªåˆ†æ”¯ feature, æ¨é€åˆ°è¿œç¨‹æœåŠ¡å™¨. ç„¶å reset ä½ çš„ master åˆ†æ”¯å’Œè¿œç¨‹æœåŠ¡å™¨ä¿æŒä¸€è‡´, å¦åˆ™ä¸‹æ¬¡ä½  pull å¹¶ä¸”ä»–äººçš„æäº¤å’Œä½ å†²çªçš„æ—¶å€™å°±ä¼šæœ‰é—®é¢˜ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">git reset HEAD^ <span class="c1"># è¿™æ˜¯æŠŠmasteræ”¾åˆ°è€çš„æäº¤ï¼ŒæŠŠfeatureä½œä¸ºä¸€ä¸ªæ–°åˆ†æ”¯</span>
</span></span><span class="line"><span class="cl">git checkout -b feature C2
</span></span><span class="line"><span class="cl">git push
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="git-è¿œç¨‹ä»“åº“é«˜çº§æ“ä½œ">Git è¿œç¨‹ä»“åº“é«˜çº§æ“ä½œ</h2>
<h3 id="æ¨é€ä¸»åˆ†æ”¯">æ¨é€ä¸»åˆ†æ”¯</h3>
<p>å¯¹äºæœ¬åœ°å’Œè¿œç¨‹ä»“åº“ä¹‹é—´çš„äº¤äº’è€Œè¨€ï¼Œä¸»åˆ†æ”¯ç”¨ origin/master æ¥æ ‡è®°ï¼Œå¦‚æœè¦åˆå¹¶å¤šä¸ªåˆ†æ”¯ï¼Œå¯ä»¥ fetch ä¹‹åå¤„ç†ï¼Œæœ€åå† pushï¼Œæ¯”éšä¾¿çš„ pull &ndash;rebase æˆ–è€… merge æ¥å¾—æ›´åŠ å¥½æ“ä½œã€‚åŒæ—¶æ³¨æ„å¥½æ¨é€æ¨çš„æ˜¯ master çš„ä½ç½®</p>
<h3 id="åˆå¹¶è¿œç¨‹ä»“åº“">åˆå¹¶è¿œç¨‹ä»“åº“</h3>
<p>ä¸ºäº† push æ–°å˜æ›´åˆ°è¿œç¨‹ä»“åº“ï¼Œä½ è¦åšçš„å°±æ˜¯ <strong>åŒ…å«</strong> è¿œç¨‹ä»“åº“ä¸­æœ€æ–°å˜æ›´ã€‚æ„æ€å°±æ˜¯åªè¦ä½ çš„æœ¬åœ°åˆ†æ”¯åŒ…å«äº†è¿œç¨‹åˆ†æ”¯ï¼ˆå¦‚ <code>o/master</code>ï¼‰ä¸­çš„æœ€æ–°å˜æ›´å°±å¯ä»¥äº†ï¼Œè‡³äºå…·ä½“æ˜¯ç”¨ rebase è¿˜æ˜¯ mergeï¼Œå¹¶æ²¡æœ‰é™åˆ¶ã€‚</p>
<p>é‚£ä¹ˆæ—¢ç„¶æ²¡æœ‰è§„å®šé™åˆ¶ï¼Œä¸ºä½•å‰é¢å‡ èŠ‚éƒ½åœ¨ç€é‡äº rebase å‘¢ï¼Ÿä¸ºä»€ä¹ˆåœ¨æ“ä½œè¿œç¨‹åˆ†æ”¯æ—¶ä¸å–œæ¬¢ç”¨ <code>merge</code> å‘¢ï¼Ÿåœ¨å¼€å‘ç¤¾åŒºé‡Œï¼Œæœ‰è®¸å¤šå…³äº merge ä¸ rebase çš„è®¨è®ºã€‚ä»¥ä¸‹æ˜¯å…³äº rebase çš„ä¼˜ç¼ºç‚¹ï¼š</p>
<p>ä¼˜ç‚¹ï¼šRebase ä½¿ä½ çš„æäº¤æ ‘å˜å¾—å¾ˆå¹²å‡€, æ‰€æœ‰çš„æäº¤éƒ½åœ¨ä¸€æ¡çº¿ä¸Š</p>
<p>ç¼ºç‚¹ï¼šRebase ä¿®æ”¹äº†æäº¤æ ‘çš„å†å²</p>
<p>æ¯”å¦‚, æäº¤ C1 å¯ä»¥è¢« rebase åˆ° C3 ä¹‹åã€‚è¿™çœ‹èµ·æ¥ C1 ä¸­çš„å·¥ä½œæ˜¯åœ¨ C3 ä¹‹åè¿›è¡Œçš„ï¼Œä½†å®é™…ä¸Šæ˜¯åœ¨ C3 ä¹‹å‰ã€‚ä¸€äº›å¼€å‘äººå‘˜å–œæ¬¢ä¿ç•™æäº¤å†å²ï¼Œå› æ­¤æ›´åçˆ± mergeã€‚è€Œå…¶ä»–äººå¯èƒ½æ›´å–œæ¬¢å¹²å‡€çš„æäº¤æ ‘ï¼Œäºæ˜¯åçˆ± rebaseã€‚ä»è€…è§ä»ï¼Œæ™ºè€…è§æ™ºã€‚</p>
<h3 id="è¿œç¨‹è¿½è¸ª">è¿œç¨‹è¿½è¸ª</h3>
<p>åœ¨å‰å‡ èŠ‚è¯¾ç¨‹ä¸­æœ‰ä»¶äº‹å„¿æŒºç¥å¥‡çš„ï¼ŒGit å¥½åƒçŸ¥é“ <code>master</code> ä¸ <code>o/master</code> æ˜¯ç›¸å…³çš„ã€‚å½“ç„¶è¿™äº›åˆ†æ”¯çš„åå­—æ˜¯ç›¸ä¼¼çš„ï¼Œå¯èƒ½ä¼šè®©ä½ è§‰å¾—æ˜¯ä¾æ­¤å°†è¿œç¨‹åˆ†æ”¯ master å’Œæœ¬åœ°çš„ master åˆ†æ”¯è¿›è¡Œäº†å…³è”ã€‚è¿™ç§å…³è”åœ¨ä»¥ä¸‹ä¸¤ç§æƒ…å†µä¸‹å¯ä»¥æ¸…æ¥šåœ°å¾—åˆ°å±•ç¤ºï¼š</p>
<ul>
<li>pull æ“ä½œæ—¶, æäº¤è®°å½•ä¼šè¢«å…ˆä¸‹è½½åˆ° o/master ä¸Šï¼Œä¹‹åå†åˆå¹¶åˆ°æœ¬åœ°çš„ master åˆ†æ”¯ã€‚éšå«çš„åˆå¹¶ç›®æ ‡ç”±è¿™ä¸ªå…³è”ç¡®å®šçš„ã€‚</li>
<li>push æ“ä½œæ—¶, æˆ‘ä»¬æŠŠå·¥ä½œä» <code>master</code> æ¨åˆ°è¿œç¨‹ä»“åº“ä¸­çš„ <code>master</code> åˆ†æ”¯ (åŒæ—¶ä¼šæ›´æ–°è¿œç¨‹åˆ†æ”¯ <code>o/master</code>)ã€‚è¿™ä¸ªæ¨é€çš„ç›®çš„åœ°ä¹Ÿæ˜¯ç”±è¿™ç§å…³è”ç¡®å®šçš„ï¼</li>
</ul>
<p>ç›´æ¥äº†å½“åœ°è®²ï¼Œ<code>master</code> å’Œ <code>o/master</code> çš„å…³è”å…³ç³»å°±æ˜¯ç”±åˆ†æ”¯çš„â€œremote trackingâ€å±æ€§å†³å®šçš„ã€‚<code>master</code> è¢«è®¾å®šä¸ºè·Ÿè¸ª <code>o/master</code>â€”â€”è¿™æ„å‘³ç€ä¸º <code>master</code> åˆ†æ”¯æŒ‡å®šäº†æ¨é€çš„ç›®çš„åœ°ä»¥åŠæ‹‰å–ååˆå¹¶çš„ç›®æ ‡ã€‚</p>
<p>ä½ å¯èƒ½æƒ³çŸ¥é“ <code>master</code> åˆ†æ”¯ä¸Šè¿™ä¸ªå±æ€§æ˜¯æ€ä¹ˆè¢«è®¾å®šçš„ï¼Œä½ å¹¶æ²¡æœ‰ç”¨ä»»ä½•å‘½ä»¤æŒ‡å®šè¿‡è¿™ä¸ªå±æ€§å‘€ï¼å¥½å§, å½“ä½ å…‹éš†ä»“åº“çš„æ—¶å€™, Git å°±è‡ªåŠ¨å¸®ä½ æŠŠè¿™ä¸ªå±æ€§è®¾ç½®å¥½äº†ã€‚</p>
<p>å½“ä½ å…‹éš†æ—¶, Git ä¼šä¸ºè¿œç¨‹ä»“åº“ä¸­çš„æ¯ä¸ªåˆ†æ”¯åœ¨æœ¬åœ°ä»“åº“ä¸­åˆ›å»ºä¸€ä¸ªè¿œç¨‹åˆ†æ”¯ï¼ˆæ¯”å¦‚ <code>o/master</code>ï¼‰ã€‚ç„¶åå†åˆ›å»ºä¸€ä¸ªè·Ÿè¸ªè¿œç¨‹ä»“åº“ä¸­æ´»åŠ¨åˆ†æ”¯çš„æœ¬åœ°åˆ†æ”¯ï¼Œé»˜è®¤æƒ…å†µä¸‹è¿™ä¸ªæœ¬åœ°åˆ†æ”¯ä¼šè¢«å‘½åä¸º <code>master</code>ã€‚</p>
<p>å…‹éš†å®Œæˆåï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªæœ¬åœ°åˆ†æ”¯ï¼ˆå¦‚æœæ²¡æœ‰è¿™ä¸ªæœ¬åœ°åˆ†æ”¯çš„è¯ï¼Œä½ çš„ç›®å½•å°±æ˜¯â€œç©ºç™½â€çš„ï¼‰ï¼Œä½†æ˜¯å¯ä»¥æŸ¥çœ‹è¿œç¨‹ä»“åº“ä¸­æ‰€æœ‰çš„åˆ†æ”¯ï¼ˆå¦‚æœä½ å¥½å¥‡å¿ƒå¾ˆå¼ºçš„è¯ï¼‰ã€‚è¿™æ ·åšå¯¹äºæœ¬åœ°ä»“åº“å’Œè¿œç¨‹ä»“åº“æ¥è¯´ï¼Œéƒ½æ˜¯æœ€ä½³é€‰æ‹©ã€‚</p>
<p>è¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆä¼šåœ¨å…‹éš†çš„æ—¶å€™ä¼šçœ‹åˆ°ä¸‹é¢çš„è¾“å‡ºï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">local branch &#34;master&#34; set to track remote branch &#34;o/master&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½ å¯ä»¥è®©ä»»æ„åˆ†æ”¯è·Ÿè¸ª <code>o/master</code>, ç„¶åè¯¥åˆ†æ”¯ä¼šåƒ <code>master</code> åˆ†æ”¯ä¸€æ ·å¾—åˆ°éšå«çš„ push ç›®çš„åœ°ä»¥åŠ merge çš„ç›®æ ‡ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥åœ¨åˆ†æ”¯ <code>totallyNotMaster</code> ä¸Šæ‰§è¡Œ <code>git push</code>ï¼Œå°†å·¥ä½œæ¨é€åˆ°è¿œç¨‹ä»“åº“çš„ <code>master</code> åˆ†æ”¯ä¸Šã€‚</p>
<h4 id="é€šè¿‡è¿œç¨‹åˆ†æ”¯æ£€å‡ºä¸€ä¸ªæ–°çš„åˆ†æ”¯">é€šè¿‡è¿œç¨‹åˆ†æ”¯æ£€å‡ºä¸€ä¸ªæ–°çš„åˆ†æ”¯</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">git checkout -b totallyNotMaster o/master
</span></span></code></pre></td></tr></table>
</div>
</div><p>å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªåä¸º <code>totallyNotMaster</code> çš„åˆ†æ”¯ï¼Œå®ƒè·Ÿè¸ªè¿œç¨‹åˆ†æ”¯ <code>o/master</code>ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">git checkout -b foo origin/master
</span></span><span class="line"><span class="cl">git pull
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¯ä»¥è·Ÿè¸ªè¿œç¨‹ä»“åº“çš„ master,æˆ‘ä»¬ä½¿ç”¨äº†éšå«çš„ç›®æ ‡ <code>o/master</code> æ¥æ›´æ–° <code>foo</code> åˆ†æ”¯ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ master å¹¶æœªè¢«æ›´æ–°ï¼</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">git checkout -b foo origin/master
</span></span><span class="line"><span class="cl">git commit
</span></span><span class="line"><span class="cl">git push
</span></span></code></pre></td></tr></table>
</div>
</div><p>å°†ä¸€ä¸ªä¸å« master çš„åˆ†æ”¯ä¸Šçš„å·¥ä½œæ¨é€åˆ°äº† <code>master</code> åˆ†æ”¯ä¸Šã€‚</p>
<h4 id="è®¾ç½®è¿œç¨‹è¿½è¸ªåˆ†æ”¯">è®¾ç½®è¿œç¨‹è¿½è¸ªåˆ†æ”¯</h4>
<p><em>è¿™ä¸ªæˆ‘ä¸ä¼š</em></p>
<p>æ‰§è¡Œï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">git branch -u o/master foo
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ · <code>foo</code> å°±ä¼šè·Ÿè¸ª <code>o/master</code> äº†ã€‚å¦‚æœå½“å‰å°±åœ¨ foo åˆ†æ”¯ä¸Š, è¿˜å¯ä»¥çœç•¥ fooï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">git branch -u o/master
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="push-1">Push</h3>
<p>ä½ å·²ç»å­¦åˆ°äº† Git æ˜¯é€šè¿‡å½“å‰æ£€å‡ºåˆ†æ”¯çš„å±æ€§æ¥ç¡®å®šè¿œç¨‹ä»“åº“ä»¥åŠè¦ push çš„ç›®çš„åœ°çš„ã€‚è¿™æ˜¯æœªæŒ‡å®šå‚æ•°æ—¶çš„è¡Œä¸ºï¼Œæˆ‘ä»¬å¯ä»¥ä¸º push æŒ‡å®šå‚æ•°ï¼Œè¯­æ³•æ˜¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">git push &lt;remote&gt; &lt;place&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>git push origin master</code> æŠŠè¿™ä¸ªå‘½ä»¤ç¿»è¯‘è¿‡æ¥å°±æ˜¯ï¼š* åˆ‡åˆ°æœ¬åœ°ä»“åº“ä¸­çš„â€œmasterâ€åˆ†æ”¯ï¼Œè·å–æ‰€æœ‰çš„æäº¤ï¼Œå†åˆ°è¿œç¨‹ä»“åº“â€œoriginâ€ä¸­æ‰¾åˆ°â€œmasterâ€åˆ†æ”¯ï¼Œå°†è¿œç¨‹ä»“åº“ä¸­æ²¡æœ‰çš„æäº¤è®°å½•éƒ½æ·»åŠ ä¸Šå»ï¼Œæå®šä¹‹åå‘Šè¯‰æˆ‘ã€‚* æˆ‘ä»¬é€šè¿‡â€œplaceâ€å‚æ•°æ¥å‘Šè¯‰ Git æäº¤è®°å½•æ¥è‡ªäº master, è¦æ¨é€åˆ°è¿œç¨‹ä»“åº“ä¸­çš„ masterã€‚å®ƒå®é™…å°±æ˜¯è¦åŒæ­¥çš„ä¸¤ä¸ªä»“åº“çš„ä½ç½®ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå› ä¸ºæˆ‘ä»¬é€šè¿‡æŒ‡å®šå‚æ•°å‘Šè¯‰äº† Git æ‰€æœ‰å®ƒéœ€è¦çš„ä¿¡æ¯, æ‰€ä»¥å®ƒå°±å¿½ç•¥äº†æˆ‘ä»¬æ‰€æ£€å‡ºçš„åˆ†æ”¯çš„å±æ€§ï¼</p>
<p>å½“ä¸º git push æŒ‡å®š place å‚æ•°ä¸º <code>master</code> æ—¶ï¼Œæˆ‘ä»¬åŒæ—¶æŒ‡å®šäº†æäº¤è®°å½•çš„æ¥æºå’Œå»å‘ã€‚ä½ å¯èƒ½æƒ³é—®â€”â€”å¦‚æœæ¥æºå’Œå»å‘åˆ†æ”¯çš„åç§°ä¸åŒå‘¢ï¼Œè¦åŒæ—¶ä¸ºæºå’Œç›®çš„åœ°æŒ‡å®š <code>&lt;place&gt;</code> çš„è¯ï¼Œåªéœ€è¦ç”¨å†’å· <code>:</code> å°†äºŒè€…è¿èµ·æ¥å°±å¯ä»¥äº†ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">git push origin &lt;source&gt;:&lt;destination&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ªå‚æ•°å®é™…çš„å€¼æ˜¯ä¸ª refspecï¼Œâ€œrefspecâ€ æ˜¯ä¸€ä¸ªè‡ªé€ çš„è¯ï¼Œæ„æ€æ˜¯ Git èƒ½è¯†åˆ«çš„ä½ç½®ï¼ˆæ¯”å¦‚åˆ†æ”¯ <code>foo</code> æˆ–è€… <code>HEAD~1</code>ï¼‰ã€‚ä¸€æ—¦ä½ æŒ‡å®šäº†ç‹¬ç«‹çš„æ¥æºå’Œç›®çš„åœ°ï¼Œå°±å¯ä»¥ç»„ç»‡å‡ºè¨€ç®€æ„èµ…çš„è¿œç¨‹æ“ä½œå‘½ä»¤äº†ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æ¼”ç¤ºï¼</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">git push origin foo^:master
</span></span></code></pre></td></tr></table>
</div>
</div><p>å°† foo^è§£æä¸ºä¸€ä¸ªä½ç½®ï¼Œä¸Šä¼ æ‰€æœ‰æœªè¢«åŒ…å«åˆ°è¿œç¨‹ä»“åº“çš„ master åˆ†æ”¯çš„æäº¤è®°å½•ã€‚</p>
<p>å¦‚æœä½ è¦æ¨é€åˆ°çš„ç›®çš„åˆ†æ”¯ä¸å­˜åœ¨ä¼šæ€ä¹ˆæ ·å‘¢ï¼Ÿæ²¡é—®é¢˜ï¼Git ä¼šåœ¨è¿œç¨‹ä»“åº“ä¸­æ ¹æ®ä½ æä¾›çš„åç§°å¸®ä½ åˆ›å»ºè¿™ä¸ªåˆ†æ”¯ï¼<code>git push origin master:newBranch</code></p>
]]></description></item><item><title>C++è¯»å†™æ–¹æ³•</title><link>https://nil-zhuang.github.io/2022/10/cpp_io/</link><pubDate>Fri, 28 Oct 2022 15:08:05 +0800</pubDate><author>Nil Zhuang</author><guid>https://nil-zhuang.github.io/2022/10/cpp_io/</guid><description><![CDATA[<h1 id="c-è¯»å†™æ–¹æ³•">C++ è¯»å†™æ–¹æ³•</h1>
<h2 id="è¾“å…¥è¾“å‡ºæµ-iostream">è¾“å…¥è¾“å‡ºæµ Iostream</h2>
<h3 id="æ ‡å‡†è¾“å…¥æµ">æ ‡å‡†è¾“å…¥æµ</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="c1">// è¾“å…¥nä¸ªæ•°å­—
</span></span></span><span class="line"><span class="cl"><span class="c1">// è¾“å…¥nä¸ªæ•°å­—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">nums</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="c1">// è¾“å…¥æœªçŸ¥ä¸ªæ•°çš„æ•°å­—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="p">(</span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">nums</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">nums</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// æå–è¾“å…¥ä¸­çš„æ•°å­—
</span></span></span><span class="line"><span class="cl"><span class="c1">// æå–è¾“å…¥ä¸­çš„åæ ‡(0,0),(1,1)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">c</span> <span class="o">&gt;&gt;</span> <span class="n">x0</span> <span class="o">&gt;&gt;</span> <span class="n">c</span> <span class="o">&gt;&gt;</span> <span class="n">y0</span> <span class="o">&gt;&gt;</span> <span class="n">c</span> <span class="o">&gt;&gt;</span> <span class="n">c</span> <span class="o">&gt;&gt;</span> <span class="n">c</span> <span class="o">&gt;&gt;</span> <span class="n">x1</span> <span class="o">&gt;&gt;</span> <span class="n">c</span> <span class="o">&gt;&gt;</span> <span class="n">y1</span> <span class="o">&gt;&gt;</span> <span class="n">c</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="cout-æ ¼å¼åŒ–è¾“å‡º">Cout æ ¼å¼åŒ–è¾“å‡º</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iomanip&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">hex</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>  <span class="c1">// è¾“å‡º16è¿›åˆ¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">oct</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>   <span class="c1">// è¾“å‡º8è¿›åˆ¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">setprecision</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="mf">1.11111111</span><span class="p">;</span>  <span class="c1">// è®¾ç½®è¾“å‡ºç²¾åº¦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">right</span> <span class="o">&lt;&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="c1">// è¾“å‡ºæŒ‡å®šå®½åº¦\å³ï¼ˆå·¦ï¼‰å¯¹é½
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">year</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;-&#39;</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">setfill</span><span class="p">(</span><span class="sc">&#39;0&#39;</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">month</span> <span class="o">&lt;&lt;</span> <span class="sc">&#39;-&#39;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">setw</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">setfill</span><span class="p">(</span><span class="sc">&#39;0&#39;</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">day</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="c1">// è¾“å‡ºå¹´æœˆæ—¥
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å­—ç¬¦ä¸²">å­—ç¬¦ä¸²</h3>
<p>ä¸»è¦çš„è¡¨ç¤ºæ–¹æ³•æœ‰ä»¥ä¸‹å››ç§ï¼š</p>
<ul>
<li>string éœ€è¦å¼•å…¥å¤´æ–‡ä»¶</li>
<li>char * æŒ‡å‘å­—ç¬¦ä¸²çš„æŒ‡é’ˆï¼Œå®è´¨ä¸Šæ˜¯æŒ‡å‘å­—ç¬¦ä¸²çš„é¦–å­—æ¯</li>
<li>const char* æŒ‡å‘ä¸€ä¸ªå¸¸é‡ç±»å‹çš„å­—ç¬¦ç±»å‹ï¼ˆä¸å¯ä¿®æ”¹</li>
<li>char[] å­—ç¬¦æ•°ç»„ï¼Œå¯¹åº”ä¸€ä¸ªå­—ç¬¦ä¸²</li>
</ul>
<h4 id="å­—ç¬¦ä¸²è¯»å–">å­—ç¬¦ä¸²è¯»å–</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">s</span><span class="p">;</span>   <span class="c1">//ä¸èƒ½è¯»å…¥ç©ºæ ¼ï¼Œä»¥ç©ºæ ¼ï¼Œåˆ¶è¡¨ç¬¦ï¼Œå›è½¦ä¸ºç»“æŸæ ‡å¿—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">string</span> <span class="n">str</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">getline</span><span class="p">(</span><span class="n">cin</span><span class="p">,</span> <span class="n">str</span><span class="p">);</span> <span class="c1">//å¯ä»¥è¯»å…¥ç©ºæ ¼å’Œåˆ¶è¡¨ç¬¦ï¼Œä»¥å›è½¦ä½œä¸ºç»“æŸæ ‡å¿—,è¦æ³¨æ„getlineçš„å°¾éƒ¨æ˜¯æœ‰ä¸€ä¸ªå›è½¦çš„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">getline</span><span class="p">(</span><span class="n">cin</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="sc">&#39; &#39;</span><span class="p">);</span> <span class="c1">// è¡¨ç¤ºä»¥&#39; &#39;ä½œä¸ºç»“æŸ
</span></span></span></code></pre></td></tr></table>
</div>
</div><h4 id="å¸¸è§æ“ä½œ">å¸¸è§æ“ä½œ</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-C++" data-lang="C++"><span class="line"><span class="cl"><span class="n">str</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="n">index</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">str</span><span class="p">[</span><span class="n">index</span><span class="p">];</span> <span class="c1">// ä»stringä¸­è·å–charå­—ç¬¦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">string</span> <span class="n">str1</span> <span class="o">=</span> <span class="s">&#34;this is a testing string.&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">string</span> <span class="n">str2</span> <span class="o">=</span> <span class="s">&#34;n example&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">str1</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">str2</span><span class="p">);</span> <span class="c1">// ç¬¬9ä¸ªå­—ç¬¦å¼€å§‹5ä¸ªå­—ç¬¦è¢«str2ä»£æ›¿ï¼Œ this is an example string
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">str</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">);</span>    <span class="c1">//æ“¦é™¤ç¬¬10ä¸ªå­—ç¬¦å¼€å§‹çš„8ä¸ªå­—ç¬¦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">str</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">str2</span><span class="p">);</span> <span class="c1">//åœ¨ç¬¬6ä¸ªä½ç½®æ’å…¥str2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// æ¯”è¾ƒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">if</span> <span class="p">(</span><span class="n">str1</span> <span class="o">&lt;</span> <span class="n">str2</span><span class="p">)</span> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;hey&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="n">str1</span><span class="p">.</span><span class="n">compare</span><span class="p">(</span><span class="n">str2</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;hey&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// è¿æ¥ä¸¤ä¸ªstringä¸²
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">string</span> <span class="n">str0</span> <span class="o">=</span> <span class="n">str1</span> <span class="o">+</span> <span class="n">str2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">str0</span> <span class="o">=</span> <span class="n">str1</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">str2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">str</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>  <span class="c1">//é•¿åº¦
</span></span></span><span class="line"><span class="cl"><span class="c1">// æŸ¥æ‰¾
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">str</span> <span class="o">=</span> <span class="s">&#34;abcabc&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">str</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#34;ab&#34;</span><span class="p">);</span> <span class="c1">//æ‰¾åˆ°ç¬¬ä¸€ä¸ª 0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">str</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#34;ab&#34;</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>    <span class="c1">//æ‰¾åˆ°ç¬¬äºŒä¸ª 4
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">str</span><span class="p">.</span><span class="n">rfind</span><span class="p">(</span><span class="s">&#34;ab&#34;</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>   <span class="c1">// 0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">string</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">str</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>   <span class="c1">// ä»0å¼€å§‹å–5ä¸ªå­—ç¬¦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">//è½¬æ¢
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">str</span> <span class="o">=</span> <span class="s">&#34;123&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">stoi</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">long</span> <span class="n">l</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">stol</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">float</span> <span class="n">f</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">stof</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kt">double</span> <span class="n">d</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">stof</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div>]]></description></item><item><title>é¡¹ç›®å¼€å‘å®ˆåˆ™</title><link>https://nil-zhuang.github.io/2022/10/project_rule/</link><pubDate>Fri, 28 Oct 2022 15:06:28 +0800</pubDate><author>Nil Zhuang</author><guid>https://nil-zhuang.github.io/2022/10/project_rule/</guid><description><![CDATA[<h1 id="project_rule">project_rule</h1>
<p>æœ¬é¡¹ç›®æ˜¯å—äº¬å¤§å­¦è½¯ä»¶å­¦é™¢ 2018 çº§è½¯ä»¶å·¥ç¨‹ä¸è®¡ç®— III è¯¾ç¨‹è®¾è®¡é¡¹ç›®</p>
<h2 id="1-æ€»ä½“è§„çº¦">1. æ€»ä½“è§„çº¦</h2>
<ol>
<li>å¼€å‘å·¥å…·ï¼šIntellij IDEA</li>
<li>æ•°æ®åº“ç®¡ç†å·¥å…·ï¼šNavicat</li>
<li>é¡¹ç›®æ–‡æ¡£å’Œæ²Ÿé€šç®¡ç†ï¼šé£ä¹¦</li>
<li>é¡¹ç›®ç‰ˆæœ¬ç®¡ç†å·¥å…·ï¼šgit</li>
<li>æ¥å£ç®¡ç†å·¥å…·ï¼šApifox</li>
</ol>
<h2 id="2-ç¼–ç¨‹è§„çº¦">2. ç¼–ç¨‹è§„çº¦</h2>
<blockquote>
<p>Craftsmanship and the Problem of Productivity: Secrets for Going Fast without Making a Mess</p>
</blockquote>
<h3 id="21-ä»£ç è§„èŒƒ">2.1 ä»£ç è§„èŒƒ</h3>
<p>JAVA ä»£ç è§„èŒƒå‚ç…§ IDEA æ’ä»¶ <strong>Alibaba Java Coding Guidelines</strong>ï¼Œå°½é‡å‡å°‘ warningï¼Œä¸èƒ½å­˜åœ¨ error</p>
<h4 id="211-è½¯å·¥è®¾è®¡åŸåˆ™">2.1.1 è½¯å·¥è®¾è®¡åŸåˆ™</h4>
<ol>
<li>
<p>å•ä¸€èŒè´£åŸåˆ™</p>
<p>å¯¹ç±»æ¥è¯´ï¼Œä¸€ä¸ªç±»åº”è¯¥åªè´Ÿè´£ä¸€é¡¹èŒè´£ã€‚å¦‚æœä¸€ä¸ªç±»è´Ÿè´£ä¸¤ä¸ªèŒè´£ï¼Œå¯èƒ½å­˜åœ¨èŒè´£ 1 å˜åŒ–ï¼Œå¼•èµ·èŒè´£ 2 çš„å˜åŒ–æƒ…å†µã€‚å¯ä»¥åŸºäºæŠ½è±¡é€»è¾‘ï¼Œæˆ–è€…ä¸šåŠ¡é€»è¾‘å¯¹ç±»è¿›è¡Œç»†åŒ–ã€‚</p>
</li>
<li>
<p>æ¥å£éš”ç¦»åŸåˆ™</p>
<p>å®¢æˆ·ç«¯ä¸åº”è¯¥ä¾èµ–å®ƒä¸éœ€è¦çš„æ¥å£ï¼Œä¸€ä¸ªç±»å¯¹å¦å¤–ä¸€ä¸ªç±»çš„ä¾èµ–ï¼Œåº”è¯¥å»ºç«‹åœ¨æœ€å°çš„æ¥å£ä¸Šã€‚</p>
</li>
<li>
<p>ä¾èµ–å€’ç½®åŸåˆ™</p>
<p>é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–ä½å±‚æ¨¡å—ï¼Œä¸¤è€…åº”ä¾èµ–å…¶æŠ½è±¡ï¼›æŠ½è±¡ä¸åº”è¯¥ä¾èµ–ç»†èŠ‚ï¼Œç»†èŠ‚åº”è¯¥ä¾èµ–æŠ½è±¡ï¼›ä¸­å¿ƒæ€æƒ³æ˜¯é¢å‘æ¥å£ç¼–ç¨‹ã€‚</p>
</li>
<li>
<p>é‡Œæ°æ›¿æ¢åŸåˆ™</p>
<p>å¦‚æœå°†æ‰€æœ‰ç±»å‹ä¸º T1 çš„å¯¹è±¡ O1 éƒ½æ›¿æ¢æˆç±»å‹ T2de å¯¹è±¡ O2ï¼Œç¨‹åºçš„è¡Œä¸ºä¸å‘ç”Ÿæ”¹å˜ã€‚é‚£ä¹ˆç±»å‹ T2 æ˜¯ç±»å‹ T1 çš„å­ç±»å‹ã€‚æ¢å¥è¯è¯´è¯´æœ‰å¼•ç”¨åŸºç±»çš„åœ°æ–¹å¿…é¡»èƒ½é€æ˜çš„ä½¿ç”¨å…¶å­ç±»çš„å¯¹è±¡ã€‚</p>
</li>
<li>
<p>å¼€é—­åŸåˆ™</p>
<p>åœ¨ä»£ç ç»“æ„çš„è®¾è®¡è®¾è®¡æ—¶ï¼Œåº”è¯¥è€ƒè™‘å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ï¼ŒæŠ½è±¡æ€ç»´æ­å»ºç»“æ„ï¼Œå…·ä½“å®ç°æ‰©å±•ç»†èŠ‚ã€‚</p>
</li>
<li>
<p>è¿ªç±³ç‰¹æ³•åˆ™</p>
<p>ä¸€ä¸ªç±»å¯¹è‡ªå·±ä¾èµ–çš„ç±»çŸ¥é“çš„è¶Šè¦è¶Šå¥½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºä¾èµ–çš„ç±»ä¸ç®¡å¤šä¹ˆå¤æ‚ï¼Œéƒ½å°½é‡å°†é€»è¾‘å°è£…åœ¨ç±»çš„å†…éƒ¨ã€‚å¯¹å¤–é™¤äº†æä¾›çš„ public æ–¹æ³•ï¼Œä¸å¯¹å¤–å¼€æ”¾ä»»ä½•ä¿¡æ¯</p>
</li>
</ol>
<h3 id="22-æ³¨é‡Šè§„èŒƒ">2.2 æ³¨é‡Šè§„èŒƒ</h3>
<ol>
<li><strong>ä»£ç æ˜¯ç”¨æ¥è¯»çš„</strong>ï¼Œä»£ç çš„æ„å›¾åº”è¯¥ç”±ä»£ç è‡ªèº«é˜è¿°ï¼Œä¼˜å…ˆè€ƒè™‘å†™æ›´å¯è¯»çš„ä»£ç </li>
<li>ä»£ç æ„å›¾æ˜æ˜¾çš„æƒ…å†µä¸‹ï¼Œä¸è¦åŠ æ³¨é‡Šé‡å¤è¯´æ˜</li>
<li>ä¸´æ—¶æ³¨é‡Šæ ‡è®°ï¼šTODO, FIXME, OPTIMIZE, REVIEW</li>
<li>æ³¨é‡Šåº”è¯¥éšç€ä»£ç æ›´æ–°</li>
</ol>
<h4 id="221-å¿…é¡»è¦å†™æ³¨é‡Šçš„æƒ…å†µ">2.2.1 å¿…é¡»è¦å†™æ³¨é‡Šçš„æƒ…å†µ</h4>
<p>ä¸ºä»€ä¹ˆï¼Œè€Œéæ˜¯ä»€ä¹ˆ</p>
<ol>
<li>çº²è¦æ€§çš„æ³¨é‡Šï¼šç®€æ´æ¸…æ™°çš„æè¿°ä¸€ä¸ªæ–‡ä»¶ã€ç±»æˆ–ä¸€ä¸ªæµç¨‹</li>
<li>å¤æ‚çš„ä¸šåŠ¡é€»è¾‘ã€ç®—æ³•</li>
<li>ä»£ç çš„ä½œç”¨ä¸ç›´è§‚æ—¶ï¼Œè§£é‡Šè¿™æ ·åšçš„åŸå› </li>
<li>å­˜åœ¨å¤šç§å¯é€‰æ–¹æ¡ˆæ—¶ï¼Œè§£é‡Šè¿™æ ·é€‰æ‹©çš„åŸå› </li>
<li>å› ä¸ºæŸäº›é™åˆ¶å¯¼è‡´ä»£ç ä¸ä¸€è‡´ã€ä¸ä¼˜é›…ã€å­˜åœ¨å‰¯ä½œç”¨æ—¶ï¼Œæ³¨æ˜åŸå› åŠåæœ</li>
<li>å‚è€ƒäº†å¤–éƒ¨èµ„æ–™æ—¶ï¼Œè¦æ³¨æ˜é“¾æ¥æ–¹ä¾¿æŸ¥çœ‹</li>
<li>æ‰€æœ‰çš„æŠ½è±¡æ–¹æ³•</li>
</ol>
<h2 id="3-æ—¥å¿—è§„çº¦">3. æ—¥å¿—è§„çº¦</h2>
<p>ä½¿ç”¨ slf4j æ¡†æ¶è®°å½•é¡¹ç›®è¿è¡Œæ—¥å¿—ï¼Œä¸è¦ç”¨ç³»ç»ŸåŸç”Ÿ log</p>
<h2 id="4-æµ‹è¯•è§„çº¦">4. æµ‹è¯•è§„çº¦</h2>
<p>AIR åŸåˆ™ï¼šå•å…ƒæµ‹è¯•åœ¨è¿è¡Œæ—¶ï¼Œè¦æ„Ÿè§‰åƒ AIR ä¸€æ ·å¹¶ä¸å­˜åœ¨ &ndash;Automatic, Independent, Repeatable</p>
<h2 id="5-å®‰å…¨è§„çº¦">5. å®‰å…¨è§„çº¦</h2>
<ol>
<li>ç”¨æˆ·è¯·æ±‚ä¼ å…¥çš„ä»»ä½•å‚æ•°å¿…é¡»åšæœ‰æ•ˆæ€§éªŒè¯ï¼Œå¿½ç•¥å‚æ•°æ ¡éªŒå¯èƒ½å¯¼è‡´
<ol>
<li>page size è¿‡å¤§å¯¼è‡´å†…å­˜æº¢å‡º</li>
<li>æ¶æ„ order å¯¼è‡´æ•°æ®åº“å®‰å…¨é£é™©æˆ–æ…¢æŸ¥è¯¢</li>
</ol>
</li>
<li>ç”¨æˆ·æ•æ„Ÿæ•°æ®å¿…é¡»è¦æ”¾åœ¨æ•°æ®åº“ä¸­ï¼Œè´¦å·å¯†ç ç­‰å¼ºå®‰å…¨æ•°æ®éœ€è¦ä½¿ç”¨å½©è™¹è¡¨ç­‰è¿›è¡ŒåŠ å¯†å¤„ç†</li>
<li>ç”¨æˆ·ä¼ å…¥çš„ SQL å‚æ•°ä¸¥æ ¼ä½¿ç”¨å‚æ•°ç»‘å®šæˆ– metadata å­—æ®µé™å®šï¼Œé˜²æ­¢ SQL æ³¨å…¥ï¼Œç¦æ­¢å­—ç¬¦ä¸²æ‹¼æ¥ SQL è®¿é—®æ•°æ®åº“ (è¿˜è®°å¾—åä¸ºçš„ drop database å—)</li>
<li>éš¶å±äºç”¨æˆ·ä¸ªäººçš„é¡µé¢æˆ–è€…åŠŸèƒ½å¿…é¡»è¿›è¡Œæƒé™æ§åˆ¶æ ¡éªŒ</li>
<li>åœ¨ä½¿ç”¨å¹³å°èµ„æº (çŸ­ä¿¡ã€é‚®ä»¶ã€ç”µè¯ç­‰) å¿…é¡»å®ç°é˜²é‡å¤é™åˆ¶ï¼Œå¦‚æ•°é‡é™åˆ¶ã€ç–²åŠ³åº¦æ§åˆ¶ã€éªŒè¯ç æ ¡éªŒç­‰ï¼Œé¿å…è¢«æ»¥ç”¨</li>
</ol>
<h2 id="6-æ•°æ®åº“è§„çº¦">6. æ•°æ®åº“è§„çº¦</h2>
<h3 id="61-å»ºè¡¨è§„çº¦">6.1 å»ºè¡¨è§„çº¦</h3>
<ol>
<li>è¡¨è¾¾æ˜¯å¦æ¦‚å¿µçš„å­—æ®µå¿…é¡»ä½¿ç”¨ is_xxx æ–¹å¼å‘½åï¼Œæ•°æ®ç±»å‹æ˜¯ <code>unsigned tinyint</code>(1 è¡¨ç¤ºæ˜¯ï¼Œ0 è¡¨ç¤ºå¦)</li>
<li>å¦‚æœç”¨å­—ç¬¦ä¸²æ¥è¡¨ç¤ºæœ‰é™ä¸ªçŠ¶æ€ (ä¾‹å¦‚ status)ï¼Œå¿…é¡»åœ¨åç«¯ä½¿ç”¨æšä¸¾ç±»å‹ä¼ å…¥å‚æ•°</li>
<li>è¡¨åã€å­—æ®µåå¿…é¡»ä½¿ç”¨å°å†™å­—æ¯æˆ–æ•°å­—ï¼Œç¦æ­¢æ•°å­—å¼€å¤´ï¼Œç¦æ­¢ä¸¤ä¸ªä¸‹åˆ’çº¿é—´åªæœ‰æ•°å­—ã€‚æ•°æ®åº“å­—æ®µåçš„ä¿®æ”¹ä»£ä»·å¾ˆå¤§ï¼Œå­—æ®µåçš„å‘½åéœ€è¦æ…é‡è€ƒè™‘ã€‚
<ul>
<li>Mysql åœ¨ Windows ä¸‹ä¸åŒºåˆ†å¤§å°å†™ï¼Œè€Œ Linux ä¸‹é»˜è®¤åŒºåˆ†ï¼Œå› æ­¤ä¸å…è®¸å‡ºç°ä»»ä½•å¤§å†™å­—æ¯</li>
</ul>
</li>
<li>è¡¨åä¸ä½¿ç”¨å¤æ•°åè¯
<ul>
<li>è¡¨ååº”è¯¥ä»…ä»…è¡¨ç¤ºè¡¨é‡Œé¢çš„å®ä½“å†…å®¹ï¼Œä¸åº”è¯¥è¡¨ç¤ºå®ä½“æ•°é‡ï¼Œå¯¹åº”äº DO ç±»åä¹Ÿæ˜¯å•æ•°å½¢å¼ï¼Œç¬¦åˆè¡¨è¾¾ä¹ æƒ¯</li>
</ul>
</li>
<li>å°æ•°ç±»å‹ä¸º decimalï¼Œç¦æ­¢ä½¿ç”¨ float å’Œ double
<ul>
<li>float å’Œ double åœ¨å­˜å‚¨çš„æ—¶å€™ï¼Œå­˜åœ¨ç²¾åº¦æŸå¤±çš„é—®é¢˜ï¼Œå¾ˆå¯èƒ½åœ¨å€¼çš„æ¯”è¾ƒæ—¶ï¼Œå¾—åˆ°ä¸æ­£ç¡®çš„ç»“æœã€‚å¦‚æœå­˜å‚¨çš„æ•°æ®èŒƒå›´è¶…è¿‡ decimal çš„èŒƒå›´ï¼Œå»ºè®®å°†æ•°æ®æ‹†æˆæ•´æ•°å’Œå°æ•°åˆ†å¼€å­˜å‚¨</li>
</ul>
</li>
<li>å¦‚æœå­˜å‚¨çš„å­—ç¬¦ä¸²é•¿åº¦å‡ ä¹ç›¸ç­‰ï¼Œä½¿ç”¨ char å®šé•¿å­—ç¬¦ä¸²ç±»å‹</li>
<li>varchar æ˜¯å¯å˜é•¿å­—ç¬¦ä¸²ï¼Œä¸é¢„å…ˆåˆ†é…å­˜å‚¨ç©ºé—´ï¼Œé•¿åº¦ä¸è¦è¶…è¿‡ 5000ï¼Œå¦‚æœå­˜å‚¨é•¿åº¦å¤§äºæ­¤å€¼ï¼Œå®šä¹‰å­—æ®µç±»å‹ä¸º textï¼Œç‹¬ç«‹å‡ºæ¥ä¸€å¼ è¡¨ï¼Œç”¨ä¸»é”®æ¥å¯¹åº”ï¼Œé¿å…å½±å“å…¶å®ƒå­—æ®µç´¢å¼•æ•ˆç‡</li>
<li>è¡¨å¿…å¤‡ä¸‰å­—æ®µï¼šid, gmt_create, gmt_modifiedã€‚
<ul>
<li>å…¶ä¸­ id å¿…ä¸ºä¸»é”®ï¼Œç±»å‹ä¸º unsigned bigintã€å•è¡¨æ—¶è‡ªå¢ã€æ­¥é•¿ä¸º 1ã€‚gmt_create, gmt_modified çš„ç±»å‹å‡ä¸º timestamp ç±»å‹ï¼Œå‰è€…ç°åœ¨æ—¶è¡¨ç¤ºä¸»åŠ¨åˆ›å»ºï¼Œåè€…è¿‡å»åˆ†è¯è¡¨ç¤ºè¢«åŠ¨æ›´æ–°</li>
</ul>
</li>
<li>è¡¨çš„å‘½åæœ€å¥½ä»¥ <code>ä¸šåŠ¡åç§°_è¡¨çš„ä½œç”¨</code> ä½œä¸ºå¼€å¤´</li>
<li>å­—æ®µå…è®¸é€‚å½“å†—ä½™ï¼Œä»¥æé«˜æŸ¥è¯¢æ€§èƒ½ï¼Œä½†å¿…é¡»è€ƒè™‘æ•°æ®ä¸€è‡´ã€‚å†—ä½™å­—æ®µåº”éµå¾ª
<ol>
<li>ä¸æ˜¯é¢‘ç¹ä¿®æ”¹çš„å­—æ®µã€‚</li>
<li>ä¸æ˜¯ varchar è¶…é•¿å­—æ®µï¼Œæ›´ä¸èƒ½æ˜¯ text å­—æ®µã€‚</li>
</ol>
</li>
<li>æ‰€æœ‰å­—ç¬¦çš„å­˜å‚¨ä¸è¡¨ç¤ºéƒ½è¦ä»¥ <code>utf-8</code> ç¼–ç 
<ul>
<li>å­—ç¬¦ç»Ÿè®¡å‡½æ•°åœ¨ä¸åŒç¼–ç æœ‰åŒºåˆ«ï¼Œå› æ­¤ç»Ÿä¸€ç¼–ç </li>
</ul>
</li>
</ol>
<h3 id="62-sql-è§„èŒƒ">6.2 SQL è§„èŒƒ</h3>
<ol>
<li>ä¸è¦ä½¿ç”¨ <code>count(åˆ—å)</code> æˆ– <code>count(å¸¸é‡)</code> æ¥æ›¿ä»£ <code>count(*)</code>ï¼Œ<code>count</code> æ˜¯ç»Ÿè®¡è¡Œæ•°çš„è¯­æ³•ï¼Œå’Œæ•°æ®åº“æ— å…³ï¼Œå’Œ NULL é NULL æ— å…³
<ul>
<li><code>count(*)</code> ä¼šç»Ÿè®¡å€¼ä¸º NULL çš„è¡Œï¼Œè€Œ <code>count(åˆ—å)</code> ä¸ä¼šç»Ÿè®¡ä¸º NULL çš„è¡Œ</li>
</ul>
</li>
<li>ä½¿ç”¨ <code>ISNULL()</code> æ¥åˆ¤æ–­æ˜¯å¦ä¸º NULLï¼Œå› ä¸º <code>NULL&lt;&gt;NULL, NULL=NULL, NULL&lt;&gt;1</code> çš„ç»“æœéƒ½æ˜¯ NULL è€Œä¸æ˜¯ true</li>
</ol>
<h2 id="7-ç‰ˆæœ¬æ§åˆ¶è§„çº¦">7. ç‰ˆæœ¬æ§åˆ¶è§„çº¦</h2>
<p>ä¹±åŠ¨ origin/main è€…ï¼Œç‹—å¤´æ‰“æ‰ï¼</p>
<blockquote>
<p><a href="https://ourai.ws/posts/working-with-git-in-team/" target="_blank" rel="noopener noreffer ">gitå›¢é˜Ÿå®è·µ</a>
<a href="http://www.ruanyifeng.com/blog/2015/08/git-use-process.html" target="_blank" rel="noopener noreffer ">é˜®ä¸€å³°gitè§„èŒƒ</a></p>
</blockquote>
<h3 id="71-commit-è§„åˆ™">7.1 Commit è§„åˆ™</h3>
<ol>
<li>commit è®°å½•ä»¥ commit ç±»å‹ä½œä¸ºå¼€å¤´ï¼š
<ol>
<li>feat æ–°ç‰¹æ€§</li>
<li>fix bug ä¿®å¤</li>
<li>hotfix å¯¹ç”Ÿäº§ä»£ç çš„ç´§æ€¥ä¿®å¤</li>
<li>docs æ–‡æ¡£æ”¹åŠ¨</li>
<li>style æ ¼å¼åŒ–</li>
<li>refactor é‡æ„ä»£ç </li>
<li>test é¡¹ç›®æµ‹è¯•</li>
</ol>
</li>
<li>commit çš„ç²’åº¦æ˜¯ä¸€ä¸ªå°åŠŸèƒ½ç‚¹æˆ–ä¸€ä¸ª bugfixï¼Œå°†æ¢å¤çš„è¯¯ä¼¤æ“ä½œé™åˆ°æœ€ä½</li>
<li>commit è®°å½•ä¸­ï¼Œç”¨ä¸€å¥ç®€ç»ƒçš„è¯æ¦‚æ‹¬ï¼Œç„¶åç©ºä¸€è¡Œé˜è¿°æäº¤å¢åŠ æˆ–ä¿®æ”¹çš„åœ°æ–¹</li>
<li>commit è¦æœ‰ç‹¬ç«‹æ€§ï¼Œå¦‚æœæ˜¯å¤šä¸ªåŠŸèƒ½ç›¸åŒæˆ–ç›¸è¿‘çš„ commit å¯ä»¥ä½¿ç”¨ rebase -i åˆå¹¶æˆ–è°ƒæ•´ï¼›å¦‚æœæ˜¯å¯¹ä¸Šä¸€ä¸ª commit çš„ä¿®æ­£å¯ä»¥ç”¨ amend ä¿®å¤ï¼›<strong>ç¦æ­¢æ— æ„ä¹‰çš„ commit</strong></li>
<li>å¦‚æœæœ‰ä¸´æ—¶ä½†æš‚æ—¶ä¸éœ€è¦æäº¤çš„æ”¹åŠ¨ï¼Œå¯ä»¥ç”¨ stash æš‚å­˜ä»£ç </li>
<li>åœ¨æœ‰å¤šä¸ª commitï¼ŒåŠŸèƒ½å¼€å‘åˆ°è¾¾ä¸€ä¸ªé‡Œç¨‹ç¢‘èŠ‚ç‚¹æˆ–æ˜¯å®ŒæˆåŠŸèƒ½å† pushï¼Œä»¥æ•´æ´ origin/masterï¼Œå°½å¯èƒ½ä¸€ä¸ª push å°±æ˜¯ä¸€ä¸ª feat</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">    feat: å®Œæˆç”¨æˆ·æ³¨å†Œæ¥å£
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    UserController æ·»åŠ äº†ç”¨æˆ·æ³¨å†Œæ¥å£ /user/register
</span></span><span class="line"><span class="cl">    UserService ç”¨æˆ·æ³¨å†Œæ¥å£ userRegister(UserVO)ï¼Œç”¨æˆ·å¯†ç æä¾›äº†å½©è™¹è¡¨æ ¡éªŒ
</span></span><span class="line"><span class="cl">    UserMapper  userRegister(UserPO)
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="72-å¼€å‘è§„åˆ™">7.2 å¼€å‘è§„åˆ™</h3>
<p>æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¹²å‡€æ•´æ´çš„ work tree</p>
<ol>
<li>æ‰€æœ‰çš„é¡¹ç›®å¼€å‘éƒ½ä¼šåœ¨ dev åˆ†æ”¯ä¸Šè¿›è¡Œï¼Œç”Ÿäº§ä»£ç ä¼šä¿ç•™åœ¨ master åˆ†æ”¯ä¸Šï¼Œé hotfix ç­‰ç´§æ€¥æƒ…å†µç¦æ­¢å‘ master åˆ†æ”¯æäº¤</li>
<li>æ‰€æœ‰æ–° feature çš„å¼€å‘éƒ½éœ€è¦å»ºç«‹ä¸€ä¸ªæ–°çš„ã€ä»¥è¯¥ feature å‘½åçš„åˆ†æ”¯ï¼Œç„¶ååœ¨è¯¥åˆ†æ”¯ä¸Šè¿›è¡Œæäº¤åï¼Œå°†å…¶ <code>merge</code> åˆ° dev åˆ†æ”¯ä¸Š</li>
<li>é¡¹ç›®æ›´æ–°ä¸€å¾‹ä½¿ç”¨ rebaseï¼Œå³ <code>git pull --rebase</code></li>
</ol>
<h3 id="73-å…¶ä½™è§„èŒƒ">7.3 å…¶ä½™è§„èŒƒ</h3>
<ol>
<li>è°æäº¤äº†.idea æˆ–è€….vscode æ–‡ä»¶å¤¹ï¼Œè°è¯·å–å¥¶èŒ¶</li>
</ol>
]]></description></item></channel></rss>